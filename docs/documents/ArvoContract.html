<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ArvoContract | arvo-core</title><meta name="description" content="Documentation for arvo-core"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><link rel="stylesheet" href="../assets/typedoc-github-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">arvo-core</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">arvo-core</a></li><li><a href="ArvoContract.html">ArvoContract</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="md:arvocontract---a-pragmatic-contract-system" class="tsd-anchor"></a><h1 class="tsd-anchor-link">ArvoContract - A pragmatic contract system<a href="#md:arvocontract---a-pragmatic-contract-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="md:getting-started-with-arvocontract" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Getting Started with ArvoContract<a href="#md:getting-started-with-arvocontract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This section provides a practical, step-by-step introduction to ArvoContract. You'll learn by building a simple user management service contract, creating events, and understanding the core patterns.</p>
<a id="md:your-first-contract" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Your First Contract<a href="#md:your-first-contract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Let's create a contract for a user registration service. This will demonstrate the core ArvoContract concepts in a realistic scenario.</p>
<a id="md:step-1-define-your-first-contract" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Step 1: Define Your First Contract<a href="#md:step-1-define-your-first-contract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Create a new file <code>contracts/user-registration.ts</code>:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createArvoContract</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">z</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;zod&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Define the contract for user registration</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">userRegistrationContract</span><span class="hl-1"> = </span><span class="hl-6">createArvoContract</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">uri:</span><span class="hl-1"> </span><span class="hl-3">&#39;#/services/user/registration&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.user.register&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">// What events this service accepts</span><br/><span class="hl-1">            </span><span class="hl-2">accepts:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-2">email:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">().</span><span class="hl-6">email</span><span class="hl-1">(</span><span class="hl-3">&#39;Must be a valid email&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">                </span><span class="hl-2">username:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">().</span><span class="hl-6">min</span><span class="hl-1">(</span><span class="hl-8">3</span><span class="hl-1">, </span><span class="hl-3">&#39;Username must be at least 3 characters&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">                </span><span class="hl-2">password:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">().</span><span class="hl-6">min</span><span class="hl-1">(</span><span class="hl-8">8</span><span class="hl-1">, </span><span class="hl-3">&#39;Password must be at least 8 characters&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">            }),</span><br/><span class="hl-1">            </span><span class="hl-7">// What events this service can emit</span><br/><span class="hl-1">            </span><span class="hl-2">emits:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-3">&#39;evt.user.registered&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                    </span><span class="hl-2">user_id:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(),</span><br/><span class="hl-1">                    </span><span class="hl-2">email:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(),</span><br/><span class="hl-1">                    </span><span class="hl-2">username:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(),</span><br/><span class="hl-1">                    </span><span class="hl-2">created_at:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">().</span><span class="hl-6">datetime</span><span class="hl-1">(),</span><br/><span class="hl-1">                }),</span><br/><span class="hl-1">                </span><span class="hl-3">&#39;evt.user.registration.failed&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                    </span><span class="hl-2">reason:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(),</span><br/><span class="hl-1">                    </span><span class="hl-2">error_code:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">enum</span><span class="hl-1">([</span><span class="hl-3">&#39;EMAIL_EXISTS&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;USERNAME_TAKEN&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;INVALID_INPUT&#39;</span><span class="hl-1">]),</span><br/><span class="hl-1">                })</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>What's happening here?</strong></p>
<ul>
<li><code>uri</code>: Unique identifier for your contract</li>
<li><code>type</code>: The event type your service accepts</li>
<li><code>accepts</code>: Schema for incoming events (using Zod for validation)</li>
<li><code>emits</code>: All possible events your service can send back</li>
</ul>
<a id="md:step-2-create-events-using-your-contract" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Step 2: Create Events Using Your Contract<a href="#md:step-2-create-events-using-your-contract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Create <code>examples/create-events.ts</code>:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createArvoEventFactory</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">userRegistrationContract</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;../contracts/user-registration&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Create a factory for your contract</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">factory</span><span class="hl-1"> = </span><span class="hl-6">createArvoEventFactory</span><span class="hl-1">(</span><span class="hl-2">userRegistrationContract</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-7">// Create an event that your service can accept</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">registrationRequest</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">accepts</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.web.frontend&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">email:</span><span class="hl-1"> </span><span class="hl-3">&#39;john.doe@example.com&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">username:</span><span class="hl-1"> </span><span class="hl-3">&#39;johndoe&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">password:</span><span class="hl-1"> </span><span class="hl-3">&#39;securepassword123&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Registration Request Event:&#39;</span><span class="hl-1">);</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-5">JSON</span><span class="hl-1">.</span><span class="hl-6">stringify</span><span class="hl-1">(</span><span class="hl-2">registrationRequest</span><span class="hl-1">.</span><span class="hl-6">toJSON</span><span class="hl-1">(), </span><span class="hl-4">null</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">));</span><br/><span class="hl-7">// Alternatively</span><br/><span class="hl-7">// console.log(registrationRequest.toString(2));</span><br/><br/><span class="hl-7">// Create a success response event</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">successResponse</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">emits</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;evt.user.registered&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.user.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-2">registrationRequest</span><span class="hl-1">.</span><span class="hl-2">subject</span><span class="hl-1">, </span><span class="hl-7">// Link to the original request</span><br/><span class="hl-1">    </span><span class="hl-2">parentid:</span><span class="hl-1"> </span><span class="hl-2">registrationRequest</span><span class="hl-1">.</span><span class="hl-2">id</span><span class="hl-1"> </span><span class="hl-7">// Link the causality of the event</span><br/><span class="hl-1">    </span><span class="hl-2">data</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-2">user_id:</span><span class="hl-1"> </span><span class="hl-3">&#39;user_123456&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">email:</span><span class="hl-1"> </span><span class="hl-3">&#39;john.doe@example.com&#39;</span><span class="hl-1">, </span><br/><span class="hl-1">        </span><span class="hl-2">username:</span><span class="hl-1"> </span><span class="hl-3">&#39;johndoe&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">created_at:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Date</span><span class="hl-1">().</span><span class="hl-6">toISOString</span><span class="hl-1">()</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;</span><span class="hl-9">\n</span><span class="hl-3">Success Response Event:&#39;</span><span class="hl-1">);</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">successResponse</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">(</span><span class="hl-8">2</span><span class="hl-1">));</span><br/><br/><span class="hl-7">// Create an error response event</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">errorResponse</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">emits</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;evt.user.registration.failed&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.user.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-2">registrationRequest</span><span class="hl-1">.</span><span class="hl-2">subject</span><span class="hl-1">, </span><span class="hl-7">// Link to the original request</span><br/><span class="hl-1">    </span><span class="hl-2">parentid:</span><span class="hl-1"> </span><span class="hl-2">registrationRequest</span><span class="hl-1">.</span><span class="hl-2">id</span><span class="hl-1"> </span><span class="hl-7">// Link the causality of the event</span><br/><span class="hl-1">    </span><span class="hl-2">data</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-2">reason:</span><span class="hl-1"> </span><span class="hl-3">&#39;Email address already exists in the system&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">error_code:</span><span class="hl-1"> </span><span class="hl-3">&#39;EMAIL_EXISTS&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;</span><span class="hl-9">\n</span><span class="hl-3">Error Response Event:&#39;</span><span class="hl-1">);</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">errorResponse</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">(</span><span class="hl-8">2</span><span class="hl-1">));</span>
</code><button type="button">Copy</button></pre>

<a id="md:step-3-run-your-first-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Step 3: Run Your First Example<a href="#md:step-3-run-your-first-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="bash"><span class="hl-6">npx</span><span class="hl-1"> </span><span class="hl-3">tsx</span><span class="hl-1"> </span><span class="hl-3">examples/create-events.ts</span>
</code><button type="button">Copy</button></pre>

<p>You should see three formatted JSON events printed to the console, each properly validated and structured according to your contract.</p>
<a id="md:understanding-what-you-built" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Understanding What You Built<a href="#md:understanding-what-you-built" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:event-structure" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Structure<a href="#md:event-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each event you created contains:</p>
<ul>
<li><strong>Standard CloudEvent fields</strong>: <code>id</code>, <code>source</code>, <code>type</code>, <code>subject</code>, <code>time</code>, etc.</li>
<li><strong>Validated data</strong>: Your <code>data</code> field is validated against the contract schema</li>
<li><strong>Automatic dataschema</strong>: References your contract version (e.g., <code>#/services/user/registration/1.0.0</code>)</li>
</ul>
<a id="md:type-safety" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Type Safety<a href="#md:type-safety" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Try modifying the data in your example with invalid values:</p>
<pre><code class="typescript"><span class="hl-7">// This will throw a validation error</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">invalidRequest</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">accepts</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.web.frontend&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">email:</span><span class="hl-1"> </span><span class="hl-3">&#39;not-an-email&#39;</span><span class="hl-1">,  </span><span class="hl-7">// Invalid email format</span><br/><span class="hl-1">        </span><span class="hl-2">username:</span><span class="hl-1"> </span><span class="hl-3">&#39;ab&#39;</span><span class="hl-1">,         </span><span class="hl-7">// Too short</span><br/><span class="hl-1">        </span><span class="hl-2">password:</span><span class="hl-1"> </span><span class="hl-3">&#39;123&#39;</span><span class="hl-1">         </span><span class="hl-7">// Too short</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The contract will catch these errors at intellisence time, compile time and event creation time, preventing invalid events from entering your system.</p>
<a id="md:next-steps-building-a-simple-service-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Next Steps: Building a Simple Service Pattern<a href="#md:next-steps-building-a-simple-service-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Let's see how contracts work in a realistic service handler pattern.</p>
<blockquote>
<p><strong>Note:</strong> Please, use <code>ArvoEventHandler</code> from <code>arvo-event-handler</code> package to handle events properly in development and production. The following documentation is for learning purposes only</p>
</blockquote>
<a id="md:step-4-create-a-simple-event-handler" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Step 4: Create a Simple Event Handler<a href="#md:step-4-create-a-simple-event-handler" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Create <code>examples/user-service-handler.ts</code>:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">ArvoEvent</span><span class="hl-1">, </span><span class="hl-2">createArvoEventFactory</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">userRegistrationContract</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;../contracts/user-registration&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Simulate a simple user database</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">userDatabase</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Set</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">&gt;(); </span><span class="hl-7">// Store emails</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">usernameDatabase</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Set</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">&gt;(); </span><span class="hl-7">// Store usernames</span><br/><br/><span class="hl-7">// Create the factory for generating responses</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">factory</span><span class="hl-1"> = </span><span class="hl-6">createArvoEventFactory</span><span class="hl-1">(</span><span class="hl-2">userRegistrationContract</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-7">// Your service handler function</span><br/><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-6">handleUserRegistration</span><span class="hl-1">(</span><span class="hl-2">event</span><span class="hl-1">: </span><span class="hl-10">ArvoEvent</span><span class="hl-1">): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;{</span><span class="hl-2">events</span><span class="hl-1">: </span><span class="hl-10">ArvoEvent</span><span class="hl-1">[]}&gt; {</span><br/><span class="hl-1">    </span><span class="hl-7">// Validate this is an event we can handle</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">type</span><span class="hl-1"> !== </span><span class="hl-2">userRegistrationContract</span><span class="hl-1">.</span><span class="hl-2">type</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">// Return system error for unknown event types</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">events:</span><span class="hl-1"> [</span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">systemError</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.user.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">subject</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">error:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-3">`Unknown event type: </span><span class="hl-4">${</span><span class="hl-2">event</span><span class="hl-11">.</span><span class="hl-2">type</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">        })]};</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">// Extract and validate the registration data</span><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">contractVersion</span><span class="hl-1"> = </span><span class="hl-2">userRegistrationContract</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">validationResult</span><span class="hl-1"> = </span><span class="hl-2">contractVersion</span><span class="hl-1">.</span><span class="hl-2">accepts</span><span class="hl-1">.</span><span class="hl-2">schema</span><span class="hl-1">.</span><span class="hl-6">safeParse</span><span class="hl-1">(</span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">data</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-2">validationResult</span><span class="hl-1">.</span><span class="hl-2">success</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">events:</span><span class="hl-1"> [</span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">emits</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;evt.user.registration.failed&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.user.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">subject</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">reason:</span><span class="hl-1"> </span><span class="hl-3">&#39;Invalid input data: &#39;</span><span class="hl-1"> + </span><span class="hl-2">validationResult</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">.</span><span class="hl-2">message</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-2">error_code:</span><span class="hl-1"> </span><span class="hl-3">&#39;INVALID_INPUT&#39;</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            })]};</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-5">email</span><span class="hl-1">, </span><span class="hl-5">username</span><span class="hl-1">, </span><span class="hl-5">password</span><span class="hl-1"> } = </span><span class="hl-2">validationResult</span><span class="hl-1">.</span><span class="hl-2">data</span><span class="hl-1">;</span><br/><br/><span class="hl-1">        </span><span class="hl-7">// Check for existing email</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">userDatabase</span><span class="hl-1">.</span><span class="hl-6">has</span><span class="hl-1">(</span><span class="hl-2">email</span><span class="hl-1">)) {</span><br/><span class="hl-1">            </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">events:</span><span class="hl-1"> [</span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">emits</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;evt.user.registration.failed&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.user.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">subject</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">reason:</span><span class="hl-1"> </span><span class="hl-3">&#39;Email address already exists&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-2">error_code:</span><span class="hl-1"> </span><span class="hl-3">&#39;EMAIL_EXISTS&#39;</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            })]};</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-7">// Check for existing username</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">usernameDatabase</span><span class="hl-1">.</span><span class="hl-6">has</span><span class="hl-1">(</span><span class="hl-2">username</span><span class="hl-1">)) {</span><br/><span class="hl-1">            </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">events:</span><span class="hl-1"> [</span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">emits</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;evt.user.registration.failed&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.user.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">subject</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">reason:</span><span class="hl-1"> </span><span class="hl-3">&#39;Username already taken&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-2">error_code:</span><span class="hl-1"> </span><span class="hl-3">&#39;USERNAME_TAKEN&#39;</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            })]};</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-7">// Simulate user creation</span><br/><span class="hl-1">        </span><span class="hl-2">userDatabase</span><span class="hl-1">.</span><span class="hl-6">add</span><span class="hl-1">(</span><span class="hl-2">email</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-2">usernameDatabase</span><span class="hl-1">.</span><span class="hl-6">add</span><span class="hl-1">(</span><span class="hl-2">username</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">userId</span><span class="hl-1"> = </span><span class="hl-3">`user_</span><span class="hl-4">${</span><span class="hl-2">Date</span><span class="hl-11">.</span><span class="hl-6">now</span><span class="hl-11">()</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">;</span><br/><br/><span class="hl-1">        </span><span class="hl-7">// Return success event</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">events:</span><span class="hl-1"> [</span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">emits</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;evt.user.registered&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.user.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">subject</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">user_id:</span><span class="hl-1"> </span><span class="hl-2">userId</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">email</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">username</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">created_at:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Date</span><span class="hl-1">().</span><span class="hl-6">toISOString</span><span class="hl-1">()</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        })]};</span><br/><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-2">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">// Handle unexpected errors with system error events</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">events:</span><span class="hl-1"> [</span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">systemError</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.user.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">subject</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">error:</span><span class="hl-1"> </span><span class="hl-2">error</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-10">Error</span><br/><span class="hl-1">        })]};</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">// Test the handler</span><br/><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-6">testHandler</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-7">// Create a test registration request</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">testRequest</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">accepts</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.web.frontend&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">email:</span><span class="hl-1"> </span><span class="hl-3">&#39;test@example.com&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">username:</span><span class="hl-1"> </span><span class="hl-3">&#39;testuser&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">password:</span><span class="hl-1"> </span><span class="hl-3">&#39;password123&#39;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Processing registration request...&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">responses</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">handleUserRegistration</span><span class="hl-1">(</span><span class="hl-2">testRequest</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-2">responses</span><span class="hl-1">.</span><span class="hl-2">events</span><span class="hl-1">.</span><span class="hl-6">forEach</span><span class="hl-1">((</span><span class="hl-2">response</span><span class="hl-1">, </span><span class="hl-2">index</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`</span><span class="hl-9">\n</span><span class="hl-3">Response </span><span class="hl-4">${</span><span class="hl-2">index</span><span class="hl-11"> </span><span class="hl-1">+</span><span class="hl-11"> </span><span class="hl-8">1</span><span class="hl-4">}</span><span class="hl-3">:`</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`Type: </span><span class="hl-4">${</span><span class="hl-2">response</span><span class="hl-11">.</span><span class="hl-2">type</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`Data:`</span><span class="hl-1">, </span><span class="hl-2">response</span><span class="hl-1">.</span><span class="hl-2">data</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-7">// Test duplicate email</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;</span><span class="hl-9">\n</span><span class="hl-3">--- Testing duplicate email ---&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">duplicateRequest</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">accepts</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.web.frontend&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">email:</span><span class="hl-1"> </span><span class="hl-3">&#39;test@example.com&#39;</span><span class="hl-1">, </span><span class="hl-7">// Same email</span><br/><span class="hl-1">            </span><span class="hl-2">username:</span><span class="hl-1"> </span><span class="hl-3">&#39;anotheruser&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">password:</span><span class="hl-1"> </span><span class="hl-3">&#39;password123&#39;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">duplicateResponses</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">handleUserRegistration</span><span class="hl-1">(</span><span class="hl-2">duplicateRequest</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">duplicateResponses</span><span class="hl-1">.</span><span class="hl-2">events</span><span class="hl-1">.</span><span class="hl-6">forEach</span><span class="hl-1">((</span><span class="hl-2">response</span><span class="hl-1">, </span><span class="hl-2">index</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`</span><span class="hl-9">\n</span><span class="hl-3">Duplicate Response </span><span class="hl-4">${</span><span class="hl-2">index</span><span class="hl-11"> </span><span class="hl-1">+</span><span class="hl-11"> </span><span class="hl-8">1</span><span class="hl-4">}</span><span class="hl-3">:`</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`Type: </span><span class="hl-4">${</span><span class="hl-2">response</span><span class="hl-11">.</span><span class="hl-2">type</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`Data:`</span><span class="hl-1">, </span><span class="hl-2">response</span><span class="hl-1">.</span><span class="hl-2">data</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">// Run the test</span><br/><span class="hl-6">testHandler</span><span class="hl-1">().</span><span class="hl-6">catch</span><span class="hl-1">(</span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:step-5-run-the-service-handler" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Step 5: Run the Service Handler<a href="#md:step-5-run-the-service-handler" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="bash"><span class="hl-6">npx</span><span class="hl-1"> </span><span class="hl-3">tsx</span><span class="hl-1"> </span><span class="hl-3">examples/user-service-handler.ts</span>
</code><button type="button">Copy</button></pre>

<p>This will demonstrate:</p>
<ul>
<li>Contract-based event validation</li>
<li>Proper error handling with typed error events</li>
<li>Service response patterns following Arvo conventions</li>
</ul>
<a id="md:key-patterns-youve-learned" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Key Patterns You've Learned<a href="#md:key-patterns-youve-learned" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:1-contract-first-design" class="tsd-anchor"></a><h3 class="tsd-anchor-link">1. Contract-First Design<a href="#md:1-contract-first-design" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The most important pattern here is defining your contract before you write any service code. This might feel backwards if you're used to building the service first and then documenting it, but trust me on this one. When you start with the contract, you're forced to think through exactly what data your service needs and what it promises to return. The contract becomes your single source of truth for validation, and as a bonus, you get amazing TypeScript intellisense and compile-time type safety throughout your entire codebase.</p>
<a id="md:2-event-factory-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">2. Event Factory Pattern<a href="#md:2-event-factory-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The event factory pattern is your best friend for creating events safely. You'll use <code>createArvoEventFactory()</code> to get a factory instance, then call different methods depending on what you're doing. Use <code>.accepts()</code> when creating events that your service will receive, <code>.emits()</code> for events your service sends out to other parts of the system, and <code>.systemError()</code> when something goes wrong and you need to communicate that failure. This pattern eliminates the guesswork around event creation and makes sure everything is properly validated.</p>
<a id="md:3-service-handler-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">3. Service Handler Pattern<a href="#md:3-service-handler-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Every service in Arvo follows the same basic signature: it takes an <code>ArvoEvent</code> and returns a <code>Promise&lt;{events: ArvoEvent[]}&gt;</code>. This consistency makes the entire system predictable and easy to reason about. Always validate incoming events against your contract first thing, use system errors when unexpected stuff happens (like network failures or database crashes), and use business errors through emit events for things you expect might go wrong (like validation failures or business rule violations).</p>
<a id="md:4-type-safety-throughout" class="tsd-anchor"></a><h3 class="tsd-anchor-link">4. Type Safety Throughout<a href="#md:4-type-safety-throughout" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The combination of TypeScript and Zod gives you protection at every level. TypeScript catches type errors at compile time so you can't accidentally create malformed events, Zod validates the actual data at runtime to make sure it matches your schema, and your IDE will give you autocompletion and inline documentation for all your event fields. This safety net catches bugs early and makes refactoring much less scary.</p>
<a id="md:whats-next" class="tsd-anchor"></a><h2 class="tsd-anchor-link">What's Next?<a href="#md:whats-next" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Now that you understand the basics, you can explore:</p>
<ol>
<li><strong><a href="#md:contract-evolution">Contract Evolution</a></strong> - Learn how to safely evolve your contracts over time</li>
<li><strong><a href="#md:event-creation">Event Creation</a></strong> - Dive deeper into advanced event creation patterns</li>
<li><strong><a href="#md:simple-contracts-with-createsimplearvocontract">Simple Contracts</a></strong> - Use streamlined contract creation for common patterns</li>
<li><strong><a href="#md:orchestrator-contracts">Orchestrator Contracts</a></strong> - Coordinate complex workflows across multiple services</li>
<li><strong><a href="#md:contract-domains">Domain Routing</a></strong> - Organize events across different processing contexts</li>
</ol>
<p>The foundation you've built here will support all these advanced patterns while maintaining the same type safety and validation guarantees.</p>
<a id="md:common-questions" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Common Questions<a href="#md:common-questions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>Q: Do I need to define every possible event type in <code>emits</code>?</strong>
A: Yes, this is intentional. It makes your service's interface explicit and enables type safety for consumers.</p>
<p><strong>Q: Can I change the contract after deployment?</strong>
A: You can add optional fields and new event types to the same version. Breaking changes require a new version. See the <a href="#md:contract-evolution">Contract Evolution</a> section for details.</p>
<p><strong>Q: How do I handle events from multiple contracts?</strong>
A: Create separate factories for each contract and check the event type to determine which handler to use.</p>
<p><strong>Q: Should I put the contract in the same repository as my service?</strong>
A: For learning, yes. In production, consider distributing contracts as separate packages to enable better collaboration between teams.</p>
<a id="md:core-concepts" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Core concepts<a href="#md:core-concepts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p><strong>Arvo</strong> is built on a foundation where all communication occurs through specialised events called <code>ArvoEvent</code>, which are basically <code>CloudEvent</code> with a few extension fields to facilitate routing and distributed telemetry. These events flow through a system of services, each acting as an event handler that processes incoming events and potentially generates new ones in response. At its heart, Arvo treats every service as a function with a consistent signature: <code>ArvoEvent =&gt; Promise&lt;ArvoEvent[]&gt;</code>.</p>
<p>The architecture connects all event handlers through a central event broker, creating a service and event mesh where each service maintains its own bounded context and state management. This flat structure enables the broker to route events based on the <code>to</code> field in the event body, ensuring efficient communication across the system.</p>
<a id="md:event-processing-and-error-handling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event processing and error handling<a href="#md:event-processing-and-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Arvo implements a sophisticated error handling mechanism where service-level issues are communicated through specialise &quot;system error&quot; events. These events are strictly scoped to handler operations, while infrastructure or environment-related problems are managed through execution errors for appropriate handling.</p>
<p>Following Martin Fowler's tolerant reader pattern, event handlers in Arvo are designed to receive all events but only process those relevant to their bounded context. When handlers encounter events outside their scope, they emit system error events rather than failing. This approach promotes resilience and clear separation of concerns across the system.</p>
<a id="md:event-chaining-and-orchestration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Chaining and Orchestration<a href="#md:event-chaining-and-orchestration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Arvo's event handlers follow the signature <code>ArvoEvent =&gt; Promise&lt;ArvoEvent[]&gt;</code>, enabling powerful service coordination through event chaining. Complex business processes can be modelled as sequences of events flowing through multiple services, while each service maintains its independence and bounded context.</p>
<p>To manage these event chains effectively, Arvo introduces the orchestrator, a specialised event handler responsible for coordinating and defining event chains. It follows a simple yet powerful execution pattern. When it receives an event, it:</p>
<ol>
<li>Resolves the current state of the execution from durable storage</li>
<li>Uses the received event and current state to calculate the next state and events</li>
<li>Persists the new state to durable storage</li>
<li>Returns the list of events to be emitted</li>
</ol>
<p>While Arvo remains implementation-agnostic about orchestration, it provides a robust implementation <code>ArvoOrchestrator</code> through the <code>arvo-xstate</code> TypeScript package. This package leverages <code>xstate</code>'s state machine capabilities to create an <code>ArvoMachine</code>, allowing developers to model complex workflows while maintaining loose coupling and independent service evolution.</p>
<p>The state-machine-driven approach ensures event chains remain predictable and manageable as system complexity grows. This makes the <code>ArvoOrchestrator</code> particularly effective for implementing business processes that require coordinated actions across multiple services while preserving the event-driven nature of the system.</p>
<p>For more detailed information about orchestration capabilities, refer to the dedicated <code>ArvoOrchestrator</code> documentation.</p>
<a id="md:reliable-service-communication" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Reliable Service Communication<a href="#md:reliable-service-communication" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>In event-driven architectures, reliable communication between services is crucial yet challenging. Arvo tackles this challenge through a thoughtful approach to coupling and contracts.</p>
<a id="md:managing-coupling-in-event-driven-systems" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Managing Coupling in Event-Driven Systems<a href="#md:managing-coupling-in-event-driven-systems" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>As <a href="https://www.youtube.com/watch?v=Saaz6D1azlU&amp;t=2124s" target="_blank" class="external">Kent Beck</a> observes, most software issues arise from coupling, and the cost of software maintenance is primarily driven by the cost of change. Changes typically fall into two categories:</p>
<ol>
<li>Business logic changes</li>
<li>Communication interface changes</li>
</ol>
<p>Both types of changes can cause issues due to unmanaged coupling. Following Larry Constantine and Ed Yourdon's definition from <a href="https://vtda.org/books/Computing/Programming/StructuredDesign_EdwardYourdonLarryConstantine.pdf" target="_blank" class="external">Structured Design</a>, coupling occurs when a change in one component necessitates changes in other components that depend on it.</p>
<p>Arvo takes a nuanced view of coupling: rather than treating it as inherently negative, it believes coupling should be managed strategically. Even in event-driven architectures, coupling naturally emerges when:</p>
<ul>
<li>Service A emits an event that Service B must handle</li>
<li>Service B changes its interface, requiring Service A to adapt its event emission</li>
</ul>
<a id="md:the-contract-first-approach" class="tsd-anchor"></a><h3 class="tsd-anchor-link">The Contract-First Approach<a href="#md:the-contract-first-approach" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To manage coupling effectively, Arvo introduces a contract-first approach inspired by Meyer's Design by Contract. Instead of services coupling directly to each other, they couple to contracts - simple data structures without business logic. This approach offers several advantages:</p>
<ol>
<li><strong>Clear Boundaries</strong>: Services declare upfront which contracts they implement and depend on</li>
<li><strong>Validation Guarantees</strong>: All communication is validated through contracts</li>
<li><strong>Trackable coupling</strong>: Contract definitions become the primary shared artefact across domain.</li>
<li><strong>Predictable Updates</strong>: When changes are needed, contracts provide a clear path for updates</li>
</ol>
<a id="md:contract-implementation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Contract Implementation<a href="#md:contract-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>In Arvo, every <code>ArvoEvent</code> contains three essential fields for reliable communication and can be validated by contracts:</p>
<ul>
<li><code>type</code>: The event type (e.g., <code>com.increment.number</code>)</li>
<li><code>data</code>: The payload object</li>
<li><code>dataschema</code>: Reference to the schema version (e.g., <code>#/service/number/increment/1.0.0</code>)</li>
</ul>
<p>Services must declare their contracts upfront and validate all communication through them. Following Martin Fowler's Tolerant Reader pattern and Postel's Law, services should:</p>
<ul>
<li>Be liberal in what they accept</li>
<li>Be conservative in what they emit</li>
<li>Validate all events against their contracts</li>
<li>Emit only contract-compliant events</li>
</ul>
<a id="md:benefits-of-contract-based-communication" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Benefits of Contract-Based Communication<a href="#md:benefits-of-contract-based-communication" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This structured approach to service communication provides several key benefits:</p>
<ol>
<li><strong>Type Safety</strong>: Contracts define clear data structures that can be type-checked</li>
<li><strong>Evolution Path</strong>: Contracts provide a structured way to evolve service interfaces</li>
<li><strong>Documentation</strong>: Contracts serve as living documentation of service capabilities</li>
<li><strong>Testing</strong>: Contracts enable automated testing of service communication</li>
<li><strong>Dependency Management</strong>: Clear contract dependencies make system evolution more predictable</li>
</ol>
<p>By treating contracts as first-class citizens in the system, Arvo provides a robust foundation for reliable service communication while managing the inevitable coupling that exists in distributed systems.</p>
<a id="md:the-arvocontract" class="tsd-anchor"></a><h1 class="tsd-anchor-link">The <code>ArvoContract</code><a href="#md:the-arvocontract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The TypeScript implementation of <code>ArvoContract</code> in <code>arvo-core</code> builds upon established software engineering principles and modern technologies. Its design is influenced by seminal works in software engineering:</p>
<ul>
<li>Bertrand Meyer's <a href="https://se.inf.ethz.ch/~meyer/publications/old/dbc_chapter.pdf" target="_blank" class="external">Contract by Design</a></li>
<li>Contracts in <a href="https://docs.racket-lang.org/reference/contracts.html#:~:text=Contracts%20in%20The%20Racket%20Guide,contract%20system%20enforces%20those%20constraints." target="_blank" class="external">Racket language</a></li>
<li>Martin Fowler's articles on <a href="https://martinfowler.com/eaaDev/EventSourcing.html" target="_blank" class="external">Event sourcing</a></li>
</ul>
<p>The implementation also incorporates practical lessons from existing contract and specification technologies:</p>
<ul>
<li>WSDL for service definitions</li>
<li>Protocol Buffers for schema evolution</li>
<li>OpenAPI (Swagger) for REST APIs</li>
<li>AsyncAPI for event-driven architectures</li>
<li>PactIO for <a href="https://docs.pact.io/getting_started/how_pact_works" target="_blank" class="external">contract testing</a></li>
</ul>
<a id="md:first-class-contract-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">First-Class Contract System<a href="#md:first-class-contract-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>In Arvo's TypeScript implementation, contracts are elevated to first-class citizens in service development. This makes the contract-first design more approachable and easy to manage. Unlike traditional approaches that separate specifications from implementation, Arvo implements contracts directly in TypeScript using Zod. This integration provides several key benefits:</p>
<ol>
<li>Natural contract definition within the development environment</li>
<li>Elimination of separate specification maintenance</li>
<li>Native TypeScript type inference with IDE integration</li>
<li>Robust compile-time type checking</li>
<li>Simplified testing through Zod-based fake data generation</li>
<li>The scope description can be defined as part of code via Zod <code>.describe</code> method for all the fields in the schema.</li>
</ol>
<a id="md:practical-advantages" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Practical Advantages<a href="#md:practical-advantages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This approach solves several common challenges in contract-driven development:</p>
<ul>
<li>Eliminates the disconnect between specifications and implementation</li>
<li>Reduces development time by avoiding duplicate effort in writing specs and code</li>
<li>Enables good software development principles in schema definitions (e.g. DRY)</li>
<li>Provides JSON schema export for documentation via <code>toJSON</code> method</li>
<li>Supports real-time contract enforcement rather than just documentation</li>
</ul>
<a id="md:contract-distribution" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Contract Distribution<a href="#md:contract-distribution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Arvo recommends distributing contracts as separate packages, either published independently or as part of a monorepo. This approach ensures contracts serve as a single source of truth, fostering genuine collaboration between services rather than becoming producer-centric documentation like traditional OpenAPI specifications.</p>
<a id="md:arvocontract-implementation-example" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ArvoContract Implementation Example<a href="#md:arvocontract-implementation-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Consider a service that interfaces with OpenAI's ChatGPT model. The contract definition would look like this:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createArvoContract</span><span class="hl-1">, </span><span class="hl-2">InferVersionedArvoContract</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;zod&#39;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">openaiCompletions</span><span class="hl-1"> = </span><span class="hl-6">createArvoContract</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">uri:</span><span class="hl-1"> </span><span class="hl-3">&quot;#/services/openai/completions&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;com.openai.completions&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">accepts:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-2">model:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">enum</span><span class="hl-1">([</span><span class="hl-3">&#39;gpt-4&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;gpt-4o&#39;</span><span class="hl-1">]),</span><br/><span class="hl-1">                </span><span class="hl-2">messages:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                    </span><span class="hl-2">role:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">enum</span><span class="hl-1">([</span><span class="hl-3">&#39;user&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;assistant&#39;</span><span class="hl-1">]),</span><br/><span class="hl-1">                    </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">()</span><br/><span class="hl-1">                }).</span><span class="hl-6">array</span><span class="hl-1">(),</span><br/><span class="hl-1">                </span><span class="hl-2">system_command:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">()</span><br/><span class="hl-1">            }),</span><br/><span class="hl-1">            </span><span class="hl-2">emits:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-3">&#39;evt.openai.completions.success&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                    </span><span class="hl-2">response:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">()</span><br/><span class="hl-1">                }),</span><br/><span class="hl-1">                </span><span class="hl-3">&#39;evt.openai.completions.error&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                    </span><span class="hl-2">error:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">()</span><br/><span class="hl-1">                })</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<p>The contract system provides comprehensive type inference capabilities. You can select specific versions using the <code>.version()</code> method, which offers IDE-assisted version selection. The system allows for inference of both accept and emit data types, providing a robust type-safe development experience.</p>
<blockquote>
<p>The <code>createArvoContact</code> is a factory function which creates the <code>ArvoContract</code>.</p>
</blockquote>
<a id="md:type-inference-and-contract-versioning" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Type Inference and Contract Versioning<a href="#md:type-inference-and-contract-versioning" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ArvoContract provides sophisticated type inference capabilities that &quot;just works&quot; and make working with contracts intuitive and type-safe. The system offers multiple ways to work with contract types, each suited to different use cases.</p>
<a id="md:basic-version-selection-and-type-inference" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Version Selection and Type Inference<a href="#md:basic-version-selection-and-type-inference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When working with contracts, developers can select specific versions using the <code>.version()</code> method:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">version1</span><span class="hl-1"> = </span><span class="hl-2">openaiCompletions</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>This method leverages TypeScript's type inference to provide IDE-assisted version selection, making it impossible to select non-existent versions. Once a version is selected, you can access its schema and infer types directly:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">version1Accept</span><span class="hl-1"> = </span><span class="hl-2">version1</span><span class="hl-1">.</span><span class="hl-2">accepts</span><span class="hl-1">.</span><span class="hl-2">schema</span><span class="hl-1">;</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">DirectAcceptType</span><span class="hl-1"> = </span><span class="hl-10">z</span><span class="hl-1">.</span><span class="hl-10">infer</span><span class="hl-1">&lt;</span><span class="hl-4">typeof</span><span class="hl-1"> </span><span class="hl-2">version1Accept</span><span class="hl-1">&gt;;</span>
</code><button type="button">Copy</button></pre>

<p>This approach yields fully typed interfaces representing the contract's accept types:</p>
<pre><code class="typescript"><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">DirectAcceptType</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-2">model</span><span class="hl-1">: </span><span class="hl-3">&#39;gpt-4&#39;</span><span class="hl-1"> | </span><span class="hl-3">&#39;gpt-4o&#39;</span><br/><span class="hl-1">    </span><span class="hl-2">messages</span><span class="hl-1">: { </span><span class="hl-2">role</span><span class="hl-1">: </span><span class="hl-3">&#39;user&#39;</span><span class="hl-1"> | </span><span class="hl-3">&#39;assistant&#39;</span><span class="hl-1">, </span><span class="hl-2">content</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1"> }[] </span><br/><span class="hl-1">    </span><span class="hl-2">system_command</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1"> </span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:advanced-type-inference-with-inferversionedarvocontract" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Advanced Type Inference with InferVersionedArvoContract<a href="#md:advanced-type-inference-with-inferversionedarvocontract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For more comprehensive type information, ArvoContract provides the <code>InferVersionedArvoContract</code> utility type:</p>
<pre><code class="typescript"><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">ContractType</span><span class="hl-1"> = </span><span class="hl-10">InferVersionedArvoContract</span><span class="hl-1">&lt;</span><span class="hl-4">typeof</span><span class="hl-1"> </span><span class="hl-2">version1</span><span class="hl-1">&gt;;</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">AcceptType</span><span class="hl-1"> = </span><span class="hl-10">ContractType</span><span class="hl-1">[</span><span class="hl-3">&#39;accepts&#39;</span><span class="hl-1">][</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">];</span>
</code><button type="button">Copy</button></pre>

<p>This utility provides access to all contract-related types, including emitted event types and system error types:</p>
<pre><code class="typescript"><span class="hl-7">// Access emit types for specific events</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">EmitType</span><span class="hl-1"> = </span><span class="hl-10">ContractType</span><span class="hl-1">[</span><span class="hl-3">&#39;emits&#39;</span><span class="hl-1">][</span><span class="hl-3">&#39;evt.openai.completions.success&#39;</span><span class="hl-1">][</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">]</span><br/><br/><span class="hl-7">// Access system error types</span><br/><span class="hl-7">// The default system error type can be resolved via</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">SystemErrorType</span><span class="hl-1"> = </span><span class="hl-10">ContractType</span><span class="hl-1">[</span><span class="hl-3">&#39;systemError&#39;</span><span class="hl-1">][</span><span class="hl-3">&#39;type&#39;</span><span class="hl-1">];</span><br/><span class="hl-7">// = sys.${contract.type}.error = sys.com.openai.completions.error</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">SystemErrorType</span><span class="hl-1"> = </span><span class="hl-10">ContractType</span><span class="hl-1">[</span><span class="hl-3">&#39;systemError&#39;</span><span class="hl-1">][</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">];</span><br/><span class="hl-7">// = ArvoErrorType</span>
</code><button type="button">Copy</button></pre>

<a id="md:understanding-arvoevent-dataschema-construction" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Understanding ArvoEvent <code>dataschema</code> Construction<a href="#md:understanding-arvoevent-dataschema-construction" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>dataschema</code> field in <code>ArvoEvent</code> plays a crucial role in version management and event validation within the Arvo system. This field is constructed by combining two essential pieces of information: the contract's URI and its version number. Let's explore how this works and why it matters.</p>
<a id="md:construction-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Construction Pattern<a href="#md:construction-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>dataschema</code> field follows a simple yet powerful construction pattern:</p>
<pre><code><span class="hl-2">$</span><span class="hl-1">{</span><span class="hl-2">ArvoContract</span><span class="hl-1">.</span><span class="hl-2">uri</span><span class="hl-1">}/</span><span class="hl-2">$</span><span class="hl-1">{</span><span class="hl-2">version</span><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<p>For example, if we have a contract with:</p>
<ul>
<li>URI: <code>&quot;#/services/openai/completions&quot;</code></li>
<li>Version: <code>&quot;1.0.0&quot;</code></li>
</ul>
<p>The resulting <code>dataschema</code> would be:</p>
<pre><code><span class="hl-1">#/</span><span class="hl-2">services</span><span class="hl-1">/</span><span class="hl-2">openai</span><span class="hl-1">/</span><span class="hl-2">completions</span><span class="hl-1">/</span><span class="hl-8">1.0</span><span class="hl-1">.</span><span class="hl-8">0</span>
</code><button>Copy</button></pre>

<a id="md:why-this-matters" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Why This Matters<a href="#md:why-this-matters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This construction pattern serves several important purposes in the Arvo ecosystem:</p>
<ol>
<li>
<p><strong>Unique Identification</strong>: By combining the contract URI with the version, each schema gets a unique identifier. This prevents any ambiguity about which version of a contract an event is using.</p>
</li>
<li>
<p><strong>Version Validation</strong>: Event handlers can easily extract the version information from the <code>dataschema</code> field to ensure they're capable of processing that specific version of the event.</p>
</li>
<li>
<p><strong>Contract Evolution</strong>: As contracts evolve, new versions can be added while maintaining backward compatibility. The <code>dataschema</code> field makes it clear which version of the contract an event adheres to.</p>
</li>
</ol>
<a id="md:real-world-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Real-World Example<a href="#md:real-world-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Consider a payment processing system:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">paymentContract</span><span class="hl-1"> = </span><span class="hl-6">createArvoContract</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">uri:</span><span class="hl-1"> </span><span class="hl-3">&quot;#/services/payments/transaction&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">accepts:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-2">amount:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">(),</span><br/><span class="hl-1">                </span><span class="hl-2">currency:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(),</span><br/><span class="hl-1">                </span><br/><span class="hl-1">            }),</span><br/><span class="hl-1">            </span><span class="hl-2">emits:</span><span class="hl-1"> {},</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-3">&#39;2.0.0&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">accepts:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-2">amount:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">(),</span><br/><span class="hl-1">                </span><span class="hl-2">currency:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(),</span><br/><span class="hl-1">                </span><span class="hl-2">metadata:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">record</span><span class="hl-1">(</span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(), </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">()) </span><br/><span class="hl-1">                </span><span class="hl-7">/**</span><br/><span class="hl-7">                 * Adding new non-optional field makes the contract </span><br/><span class="hl-7">                 * more restricted and hence adds a breaking change</span><br/><span class="hl-7">                 * and warrents a new contract version.</span><br/><span class="hl-7">                 */</span><br/><span class="hl-1">            }),</span><br/><span class="hl-1">            </span><span class="hl-2">emits:</span><span class="hl-1"> {}</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>When events are created using this contract:</p>
<ul>
<li>A v1 event will have <code>dataschema</code>: <code>&quot;#/services/payments/transaction/1.0.0&quot;</code></li>
<li>A v2 event will have <code>dataschema</code>: <code>&quot;#/services/payments/transaction/2.0.0&quot;</code></li>
</ul>
<p>This clear identification helps services understand exactly which version of the contract they're dealing with, enabling proper handling and validation of the event data structure.</p>
<a id="md:additional-contract-factories" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Additional Contract Factories<a href="#md:additional-contract-factories" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>While <code>createArvoContract</code> provides complete flexibility for contract creation, many services follow simpler patterns. The <code>arvo-core</code> package includes specialized factory functions to streamline contract creation for common use cases.</p>
<a id="md:simple-contracts-with-createsimplearvocontract" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Simple Contracts with <code>createSimpleArvoContract</code><a href="#md:simple-contracts-with-createsimplearvocontract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For services that follow a basic request-response pattern, <code>createSimpleArvoContract</code> offers a more concise way to define contracts. This factory:</p>
<ol>
<li>Automatically prefixes event types with standard namespaces:
<ul>
<li>Input events: <code>com.{type}</code></li>
<li>Success events: <code>evt.{type}.success</code></li>
<li>Error events: <code>sys.com.{type}.error</code></li>
</ul>
</li>
<li>Enforces a single input schema and single output schema</li>
<li>Manages system event type generation automatically</li>
</ol>
<a id="md:schema-reuse-and-contract-evolution" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Schema Reuse and Contract Evolution<a href="#md:schema-reuse-and-contract-evolution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>One powerful aspect of Arvo's TypeScript-first approach is the ability to reuse schema definitions. This is particularly valuable when multiple services share similar interfaces within the same bounded context.</p>
<a id="md:when-to-reuse-schemas" class="tsd-anchor"></a><h4 class="tsd-anchor-link">When to Reuse Schemas<a href="#md:when-to-reuse-schemas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Schema reuse should be approached carefully to avoid creating unintended coupling between services. Consider reusing schemas when:</p>
<ol>
<li>Services share the same bounded context</li>
<li>The shared schema represents a stable, well-understood domain concept</li>
<li>The services are maintained by the same team</li>
<li>Changes to the schema should/ must naturally affect all services using it</li>
<li>A common understanding that once established changing the common schema will be extremely costly and will have cascading effects</li>
</ol>
<a id="md:example-genai-services" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Example: GenAI Services<a href="#md:example-genai-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Let's look at a practical example where schema reuse makes sense - Generative AI services that share common parameters and response structures.</p>
<p>First, we define our base schemas in <code>commons/schema.base.genai.ts</code>:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">z</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;zod&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">/**</span><br/><span class="hl-7"> * Base input schema for GenAI operations.</span><br/><span class="hl-7"> * Defines common parameters used across different AI service providers.</span><br/><span class="hl-7"> */</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">accept</span><span class="hl-1"> = </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">max_tokens:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">()</span><br/><span class="hl-1">        .</span><span class="hl-6">min</span><span class="hl-1">(</span><span class="hl-8">10</span><span class="hl-1">, </span><span class="hl-3">&#39;The minimum number of completion tokens must be 10&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-6">max</span><span class="hl-1">(</span><span class="hl-8">4096</span><span class="hl-1">, </span><span class="hl-3">&#39;The maximum number of completion tokens must be 4096&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-3">&#39;The maximum output tokens.&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-6">default</span><span class="hl-1">(</span><span class="hl-8">4096</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-2">system_command:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">()</span><br/><span class="hl-1">        .</span><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-3">&#39;The persona the language model should assume&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-6">default</span><span class="hl-1">(</span><span class="hl-3">&#39;You are a helpful assistant&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-2">temperature:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">()</span><br/><span class="hl-1">        .</span><span class="hl-6">min</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-6">max</span><span class="hl-1">(</span><span class="hl-8">1</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-3">&#39;Controls output randomness&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-6">default</span><span class="hl-1">(</span><span class="hl-8">0.5</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-2">json_response:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">boolean</span><span class="hl-1">()</span><br/><span class="hl-1">        .</span><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-3">&#39;Request JSON formatted response&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-6">default</span><span class="hl-1">(</span><span class="hl-4">false</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-2">messages:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">array</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-2">role:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">enum</span><span class="hl-1">([</span><span class="hl-3">&#39;user&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;assistant&#39;</span><span class="hl-1">]),</span><br/><span class="hl-1">            </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">()</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">    ).</span><span class="hl-6">min</span><span class="hl-1">(</span><span class="hl-8">1</span><span class="hl-1">)</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">/**</span><br/><span class="hl-7"> * Base output schema for GenAI operations.</span><br/><span class="hl-7"> * Defines common response structure and metadata.</span><br/><span class="hl-7"> */</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">emit</span><span class="hl-1"> = </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">json_valid:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">boolean</span><span class="hl-1">().</span><span class="hl-6">nullable</span><span class="hl-1">()</span><br/><span class="hl-1">        .</span><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-3">&#39;Indicates if output is valid JSON when requested&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-2">message:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">role:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">literal</span><span class="hl-1">(</span><span class="hl-3">&#39;assistant&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">()</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-2">usage:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">tokens:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-2">prompt:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">(),</span><br/><span class="hl-1">            </span><span class="hl-2">completion:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">(),</span><br/><span class="hl-1">            </span><span class="hl-2">total:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">()</span><br/><span class="hl-1">        }),</span><br/><span class="hl-1">        </span><span class="hl-2">time_ms:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-2">to_first_token:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">(),</span><br/><span class="hl-1">            </span><span class="hl-2">average_token:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">(),</span><br/><span class="hl-1">            </span><span class="hl-2">total:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">()</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-2">stop_reason:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">enum</span><span class="hl-1">([</span><span class="hl-3">&#39;stop&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;length&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;content_filter&#39;</span><span class="hl-1">])</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Then, we can create specific service contracts that extend these base schemas:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createSimpleArvoContract</span><span class="hl-1">, </span><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-2">InferVersionedArvoContract</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">z</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;zod&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-4">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-2">BaseGenAISchema</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;../commons/schema.base.genai&#39;</span><span class="hl-1">;</span><br/><br/><br/><span class="hl-7">// Defining Anthropic service contract</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">anthropic</span><span class="hl-1"> = </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">enum</span><span class="hl-1">([</span><br/><span class="hl-1">	</span><span class="hl-3">&#39;claude-3-5-sonnet-20240620&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-3">&#39;claude-3-sonnet-20240229&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-3">&#39;claude-3-opus-20240229&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-3">&#39;claude-3-haiku-20240307&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">]);</span><br/><span class="hl-1">  </span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">anthropicCompletions</span><span class="hl-1"> = </span><span class="hl-6">createSimpleArvoContract</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-2">uri:</span><span class="hl-1"> </span><span class="hl-3">&#39;#/services/anthropic/completions&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;anthropic.completions&#39;</span><span class="hl-1">, </span><span class="hl-7">// = &#39;com.anthropic.completions&#39;</span><br/><span class="hl-1">	</span><span class="hl-2">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">			</span><span class="hl-2">accepts:</span><span class="hl-1"> </span><span class="hl-2">BaseGenAISchema</span><span class="hl-1">.</span><span class="hl-2">accept</span><span class="hl-1">.</span><span class="hl-6">merge</span><span class="hl-1">(</span><br/><span class="hl-1">				</span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">					</span><span class="hl-2">model:</span><span class="hl-1"> </span><span class="hl-2">anthropic</span><span class="hl-1">.</span><span class="hl-6">default</span><span class="hl-1">(</span><span class="hl-3">&#39;claude-3-haiku-20240307&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">				}),</span><br/><span class="hl-1">			),</span><br/><span class="hl-1">			</span><span class="hl-2">emits:</span><span class="hl-1"> </span><span class="hl-2">BaseGenAISchema</span><span class="hl-1">.</span><span class="hl-2">emit</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-7">// type = &#39;evt.anthropic.completions.success&#39;</span><br/><span class="hl-1">		},</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">});</span><br/><span class="hl-7">// system error type = &#39;sys.com.anthropic.completions.error&#39;</span><br/><br/><span class="hl-7">// Defining OpenAI service contract</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">openai</span><span class="hl-1"> = </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">enum</span><span class="hl-1">([</span><span class="hl-3">&#39;gpt-4o&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;gpt-4-turbo&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;gpt-4o-mini&#39;</span><span class="hl-1">]);</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">openaiCompletions</span><span class="hl-1"> = </span><span class="hl-6">createSimpleArvoContract</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-2">uri:</span><span class="hl-1"> </span><span class="hl-3">&#39;#/services/openai/completions&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;openai.completions&#39;</span><span class="hl-1">, </span><span class="hl-7">// = &#39;com.openai.completions&#39;</span><br/><span class="hl-1">	</span><span class="hl-2">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">			</span><span class="hl-2">accepts:</span><span class="hl-1"> </span><span class="hl-2">BaseGenAISchema</span><span class="hl-1">.</span><span class="hl-2">accept</span><span class="hl-1">.</span><span class="hl-6">merge</span><span class="hl-1">(</span><br/><span class="hl-1">				</span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">					</span><span class="hl-2">model:</span><span class="hl-1"> </span><span class="hl-2">openai</span><span class="hl-1">.</span><span class="hl-6">default</span><span class="hl-1">(</span><span class="hl-3">&#39;gpt-4o-mini&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">				}),</span><br/><span class="hl-1">			),</span><br/><span class="hl-1">			</span><span class="hl-2">emits:</span><span class="hl-1"> </span><span class="hl-2">BaseGenAISchema</span><span class="hl-1">.</span><span class="hl-2">emit</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-7">// type = &#39;evt.openai.completions.success&#39;</span><br/><span class="hl-1">		},</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">});</span><br/><span class="hl-7">// system error type = &#39;sys.com.openai.completions.success&#39;</span>
</code><button type="button">Copy</button></pre>

<p>This approach provides several benefits:</p>
<ol>
<li><strong>DRY Code</strong>: Common schemas are defined once and reused</li>
<li><strong>Consistent Interfaces</strong>: All AI services share the same base interface</li>
<li><strong>Type Safety</strong>: TypeScript provides full type inference for the shared schemas</li>
<li><strong>Evolution Path</strong>: Base schemas can be versioned independently</li>
<li><strong>Clear Documentation</strong>: Schema descriptions are centralised</li>
</ol>
<p>The resulting contracts maintain individual service boundaries while sharing common structures where appropriate. Service-specific additions (like model selection) are cleanly merged with the base schema.</p>
<a id="md:orchestrator-contracts" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Orchestrator Contracts<a href="#md:orchestrator-contracts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>An orchestrator in Arvo is a special type of event handler that coordinates complex workflows across multiple services. Rather than performing tasks directly, it emits command events to other services and manages their responses. For example, in a document processing system, an orchestrator might coordinate between a text extraction service, a translation service, and a storage service.</p>
<p>What makes orchestrators unique is their ability to maintain state and make decisions based on the responses they receive. They follow Arvo's event handler pattern (<code>ArvoEvent =&gt; Promise&lt;ArvoEvent[]&gt;</code>), but they're designed specifically for coordination rather than direct task execution.</p>
<a id="md:parent-subject-in-orchestration" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Parent Subject in Orchestration<a href="#md:parent-subject-in-orchestration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Each orchestrator execution is uniquely identified by an event subject. When orchestrators need to coordinate, they use the <code>parentSubject$$</code> field to establish execution context relationships. The root orchestrator sets <code>parentSubject$$</code> to <code>null</code>, while child orchestrators receive the parent's subject as their <code>parentSubject$$</code>.</p>
<blockquote>
<p><strong>Note</strong>: An orchestrator defines a workflow, while an orchestration execution is a specific instance of that workflow. Each execution is identified by a unique subject string that's included in all related ArvoEvents. The orchestrator uses this subject to track execution state in storage (memory or database). When processing events, the orchestrator optimistically locks the execution state to handle parallel events or multiple service responses safely.</p>
</blockquote>
<a id="md:execution-context-flow" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Execution Context Flow<a href="#md:execution-context-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When an orchestrator completes its execution, it determines its completion event's subject based on the <code>parentSubject$$</code> received during initialization. For root executions (<code>parentSubject$$ = null</code>), it uses its own subject. For child executions, it uses the <code>parentSubject$$</code> value, effectively returning control to the parent orchestrator.</p>
<p>The <code>parentSubject$$</code> field is strictly for orchestrator coordination and should never be used in communication with regular services. This separation maintains clean boundaries between orchestration logic and service implementation.</p>
<a id="md:creating-orchestrator-contracts" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Creating Orchestrator Contracts<a href="#md:creating-orchestrator-contracts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The <code>createArvoOrchestratorContract</code> factory simplifies creating contracts for orchestration services. It automatically handles common orchestration patterns and establishes consistent event naming:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createArvoOrchestratorContract</span><span class="hl-1">, </span><span class="hl-2">ArvoErrorSchema</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">z</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;zod&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-4">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-2">LLMs</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;../commons/genai.llms&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-4">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-2">BaseGenAISchema</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;../commons/schema.base.genai&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">createOrchestratorCompletionSchema</span><span class="hl-1"> = &lt;</span><span class="hl-10">T</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-10">z</span><span class="hl-1">.</span><span class="hl-10">AnyZodObject</span><span class="hl-1">&gt;(</span><span class="hl-2">schema</span><span class="hl-1">: </span><span class="hl-10">T</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">		</span><span class="hl-2">status:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">enum</span><span class="hl-1">([</span><span class="hl-3">&#39;success&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;error&#39;</span><span class="hl-1">]),</span><br/><span class="hl-1">		</span><span class="hl-2">errors:</span><span class="hl-1"> </span><span class="hl-2">ArvoErrorSchema</span><span class="hl-1">.</span><span class="hl-6">array</span><span class="hl-1">().</span><span class="hl-6">nullable</span><span class="hl-1">(),</span><br/><span class="hl-1">		</span><span class="hl-2">result:</span><span class="hl-1"> </span><span class="hl-2">schema</span><span class="hl-1">.</span><span class="hl-6">nullable</span><span class="hl-1">(),</span><br/><span class="hl-1">	});</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">// Define which AI models are supported</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">llmModelSchema</span><span class="hl-1"> = </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">union</span><span class="hl-1">([</span><br/><span class="hl-1">    </span><span class="hl-7">// Anthropic models</span><br/><span class="hl-1">    </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">provider:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">literal</span><span class="hl-1">(</span><span class="hl-3">&#39;anthropic&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-2">model:</span><span class="hl-1"> </span><span class="hl-2">LLMs</span><span class="hl-1">.</span><span class="hl-2">anthropic</span><span class="hl-1">.</span><span class="hl-6">default</span><span class="hl-1">(</span><span class="hl-3">&#39;claude-3-haiku-20240307&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">    </span><span class="hl-7">// OpenAI models</span><br/><span class="hl-1">    </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">provider:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">literal</span><span class="hl-1">(</span><span class="hl-3">&#39;openai&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-2">model:</span><span class="hl-1"> </span><span class="hl-2">LLMs</span><span class="hl-1">.</span><span class="hl-2">openai</span><span class="hl-1">.</span><span class="hl-6">default</span><span class="hl-1">(</span><span class="hl-3">&#39;gpt-4o-mini&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">]);</span><br/><br/><span class="hl-7">// Create the orchestrator contract</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">llmOrchestrator</span><span class="hl-1"> = </span><span class="hl-6">createArvoOrchestratorContract</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">uri:</span><span class="hl-1"> </span><span class="hl-3">&#39;#/orchestrators/llm&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;llm&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">// Initial event schema</span><br/><span class="hl-1">            </span><span class="hl-2">init:</span><span class="hl-1"> </span><span class="hl-2">BaseGenAISchema</span><span class="hl-1">.</span><span class="hl-2">accept</span><span class="hl-1">.</span><span class="hl-6">merge</span><span class="hl-1">(</span><br/><span class="hl-1">                </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                    </span><span class="hl-2">model:</span><span class="hl-1"> </span><span class="hl-2">llmModelSchema</span><span class="hl-1">,</span><br/><span class="hl-1">                })</span><br/><span class="hl-1">            ),</span><br/><br/><span class="hl-1">            </span><span class="hl-7">// Completion event schema</span><br/><span class="hl-1">            </span><span class="hl-2">complete:</span><span class="hl-1"> </span><span class="hl-6">createOrchestratorCompletionSchema</span><span class="hl-1">(</span><br/><span class="hl-1">                </span><span class="hl-2">BaseGenAISchema</span><span class="hl-1">.</span><span class="hl-2">emit</span><span class="hl-1">.</span><span class="hl-6">merge</span><span class="hl-1">(</span><br/><span class="hl-1">                    </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                        </span><span class="hl-2">model:</span><span class="hl-1"> </span><span class="hl-2">llmModelSchema</span><span class="hl-1">,</span><br/><span class="hl-1">                    })</span><br/><span class="hl-1">                )</span><br/><span class="hl-1">            ),</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The factory automatically generates consistent event types:</p>
<ul>
<li>Initialization events: <code>arvo.orc.{name}</code> (e.g., <code>arvo.orc.llm</code>)</li>
<li>Completion events: <code>arvo.orc.{name}.done</code> (e.g., <code>arvo.orc.llm.done</code>)</li>
<li>System errors: <code>sys.arvo.orc.{name}.error</code> (e.g., <code>sys.arvo.orc.llm.error</code>)</li>
</ul>
<a id="md:type-safety-and-contract-usage" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Type Safety and Contract Usage<a href="#md:type-safety-and-contract-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The orchestrator contract provides full TypeScript type inference. You can access the contract's types for both initialization and completion events:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">version1</span><span class="hl-1"> = </span><span class="hl-2">llmOrchestrator</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">ContractType</span><span class="hl-1"> = </span><span class="hl-10">InferVersionedArvoContract</span><span class="hl-1">&lt;</span><span class="hl-4">typeof</span><span class="hl-1"> </span><span class="hl-2">version1</span><span class="hl-1">&gt;;</span><br/><br/><span class="hl-7">// Get the initialization event type and data structure</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">InitType</span><span class="hl-1"> = </span><span class="hl-10">ContractType</span><span class="hl-1">[</span><span class="hl-3">&#39;accepts&#39;</span><span class="hl-1">][</span><span class="hl-3">&#39;type&#39;</span><span class="hl-1">];        </span><span class="hl-7">// &quot;arvo.orc.llm&quot;</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">InitDataType</span><span class="hl-1"> = </span><span class="hl-10">ContractType</span><span class="hl-1">[</span><span class="hl-3">&#39;accepts&#39;</span><span class="hl-1">][</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">];    </span><span class="hl-7">// Full data structure</span><br/><br/><span class="hl-7">// Get the completion event type and data structure</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">CompleteType</span><span class="hl-1"> = </span><span class="hl-10">ContractType</span><span class="hl-1">[</span><span class="hl-3">&#39;emits&#39;</span><span class="hl-1">][</span><span class="hl-10">ContractType</span><span class="hl-1">[</span><span class="hl-3">&#39;metadata&#39;</span><span class="hl-1">][</span><span class="hl-3">&#39;completeEventType&#39;</span><span class="hl-1">]][</span><span class="hl-3">&#39;type&#39;</span><span class="hl-1">];</span><br/><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">CompleteDataType</span><span class="hl-1"> = </span><span class="hl-10">ContractType</span><span class="hl-1">[</span><span class="hl-3">&#39;emits&#39;</span><span class="hl-1">][</span><span class="hl-10">ContractType</span><span class="hl-1">[</span><span class="hl-3">&#39;metadata&#39;</span><span class="hl-1">][</span><span class="hl-3">&#39;completeEventType&#39;</span><span class="hl-1">]][</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">];</span><br/><br/><span class="hl-7">// The metadata are additional data inserted via the factory</span>
</code><button type="button">Copy</button></pre>

<p>This type safety ensures that orchestration events are properly structured throughout your system, making it easier to maintain and evolve complex workflows over time.</p>
<p>Let me help improve the Event Creation section by restructuring it to be clearer and more comprehensive. I'll organize it to build understanding from fundamental concepts to practical implementation.</p>
<a id="md:event-creation" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Event Creation<a href="#md:event-creation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Event creation is a core feature of the Arvo system that ensures type safety and validation through the <code>ArvoContract</code>. Let's understand how event creation works and explore the tools provided by <code>arvo-core</code> to make this process robust and developer-friendly.</p>
<a id="md:core-concepts-1" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Concepts<a href="#md:core-concepts-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The event creation system in Arvo is built around three key elements:</p>
<ol>
<li><code>ArvoEvent</code> - The base event type that represents all events in the system</li>
<li><code>ArvoContract</code> - A validation layer that ensures events conform to specified schemas</li>
<li>Event Factories - Helper functions that create properly structured and validated events</li>
</ol>
<a id="md:the-arvoeventfactory" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The ArvoEventFactory<a href="#md:the-arvoeventfactory" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The primary tool for creating events is the <code>ArvoEventFactory</code>, which provides two main methods for event creation:</p>
<ul>
<li><code>.accepts()</code> - Creates events that a service can receive</li>
<li><code>.emits()</code> - Creates events that a service can send</li>
<li><code>.systemError()</code> - Creates the system error event</li>
</ul>
<p>Let's explore each usage pattern in detail.</p>
<a id="md:creating-receivable-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Creating Receivable Events<a href="#md:creating-receivable-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When creating events that your service will receive, use the <code>accepts()</code> method. Here's a complete example:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createArvoEventFactory</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Initialize the factory with a specific contract version</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">factory</span><span class="hl-1"> = </span><span class="hl-6">createArvoEventFactory</span><span class="hl-1">(</span><span class="hl-2">anthropicCompletions</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-7">// Create an event the service can accept</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">receivableEvent</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">accepts</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.test.test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-3">&#39;test-subject&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">messages:</span><span class="hl-1"> [</span><br/><span class="hl-1">            {</span><br/><span class="hl-1">                </span><span class="hl-2">role:</span><span class="hl-1"> </span><span class="hl-3">&#39;user&#39;</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-3">&#39;Hello World&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">        ],</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// dataschema = &#39;#/services/anthropic/completions/1.0.0&#39;</span>
</code><button type="button">Copy</button></pre>

<p>The factory automatically handles several important aspects:</p>
<ul>
<li>Validates the event structure against the contract</li>
<li>Provides TypeScript intellisense for better developer experience</li>
<li>Adds default values for optional fields</li>
<li>Ensures version compatibility by automatically adding <code>dataschema</code> field</li>
</ul>
<a id="md:creating-emittable-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Creating Emittable Events<a href="#md:creating-emittable-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For events that your service will emit, use the <code>emits()</code> method. This requires additional configuration since services can emit multiple event types:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createArvoEventFactory</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Initialize the factory with a specific contract version</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">factory</span><span class="hl-1"> = </span><span class="hl-6">createArvoEventFactory</span><span class="hl-1">(</span><span class="hl-2">anthropicCompletions</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-7">// Create an event the service can emit</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">emittableEvent</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">emits</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.test.test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-3">&#39;test-subject&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;evt.anthropic.completions.success&#39;</span><span class="hl-1">,  </span><span class="hl-7">// Specify the event type</span><br/><span class="hl-1">    </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">json_valid:</span><span class="hl-1"> </span><span class="hl-4">null</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">message:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">role:</span><span class="hl-1"> </span><span class="hl-3">&#39;assistant&#39;</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-3">&#39;Hello World&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-2">stop_reason:</span><span class="hl-1"> </span><span class="hl-3">&#39;stop&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">usage:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">time_ms:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">to_first_token:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">average_token:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">total:</span><span class="hl-1"> </span><span class="hl-8">0</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-2">tokens:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">prompt:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">completion:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">total:</span><span class="hl-1"> </span><span class="hl-8">0</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// dataschema = &#39;#/services/anthropic/completions/1.0.0&#39;</span>
</code><button type="button">Copy</button></pre>

<a id="md:creating-system-error" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Creating System Error<a href="#md:creating-system-error" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>ArvoEventFactory</code> provides a specialized <code>.systemError()</code> method for handling system-level errors in a standardized way. This method creates error events that follow Arvo's system-wide error handling conventions.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createArvoEventFactory</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Initialize the factory with a specific contract version</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">factory</span><span class="hl-1"> = </span><span class="hl-6">createArvoEventFactory</span><span class="hl-1">(</span><span class="hl-2">anthropicCompletions</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">errorEvent</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">systemError</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.test.test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-3">&#39;test-subject&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">error:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-3">&quot;Some Error&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// dataschema = &#39;#/services/anthropic/completions/0.0.0&#39;</span>
</code><button type="button">Copy</button></pre>

<p>Key features of system error events:</p>
<ol>
<li><strong>Standardized Type</strong>: The event type is automatically set to the system error type - no need to specify it manually</li>
<li><strong>Version Independence</strong>: Always uses the wildcard version <code>0.0.0</code> in the <code>dataschema</code> regardless of the contract version</li>
<li><strong>Error Field</strong>: Uses an <code>error</code> field instead of <code>data</code> to properly capture error information</li>
</ol>
<p>Let me rewrite the ArvoOrchestratorEventFactory section to make it clearer and more comprehensive.</p>
<a id="md:the-arvoorchestratoreventfactory" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The <code>ArvoOrchestratorEventFactory</code><a href="#md:the-arvoorchestratoreventfactory" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>While regular events can be created using the standard <code>ArvoEventFactory</code>, orchestrator events have unique characteristics that warrant their own specialized factory. The <code>ArvoOrchestratorEventFactory</code> is designed specifically for creating events that coordinate complex workflows across multiple services.</p>
<a id="md:initialization-events-with-init" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Initialization Events with <code>.init()</code><a href="#md:initialization-events-with-init" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>.init()</code> method creates events that start new orchestration workflows. These events are particularly special because they can establish parent-child relationships between different orchestration processes. Here's how it works:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createArvoOrchestratorEventFactory</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Create a factory for a specific version of our LLM orchestrator</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">factory</span><span class="hl-1"> = </span><span class="hl-6">createArvoOrchestratorEventFactory</span><span class="hl-1">(</span><span class="hl-2">llmOrchestrator</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">))</span><br/><br/><span class="hl-7">// Create an initialization event</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">initEvent</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">init</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.test.test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">// null parentSubject$$ indicates this is starting a new workflow</span><br/><span class="hl-1">        </span><span class="hl-2">parentSubject$$:</span><span class="hl-1"> </span><span class="hl-4">null</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">model:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">provider:</span><span class="hl-1"> </span><span class="hl-3">&#39;openai&#39;</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-2">messages:</span><span class="hl-1"> [</span><br/><span class="hl-1">            {</span><br/><span class="hl-1">                </span><span class="hl-2">role:</span><span class="hl-1"> </span><span class="hl-3">&#39;user&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-3">&quot;Hello world&quot;</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        ],</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<p>The initialization event sets up the initial state and parameters for the workflow. The <code>parentSubject$$</code> field is particularly important:</p>
<ul>
<li>When <code>null</code>, it starts a new independent workflow</li>
<li>When set to another orchestrator's subject, it creates a sub-workflow</li>
</ul>
<p>This enables building complex, nested orchestration patterns while maintaining clear relationships between workflows.</p>
<a id="md:completion-events-with-complete" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Completion Events with <code>.complete()</code><a href="#md:completion-events-with-complete" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>.complete()</code> method creates events that signal the completion of orchestrated workflows. These events carry the final results or any error information:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createArvoOrchestratorEventFactory</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">factory</span><span class="hl-1"> = </span><span class="hl-6">createArvoOrchestratorEventFactory</span><span class="hl-1">(</span><span class="hl-2">llmOrchestrator</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">))</span><br/><br/><span class="hl-7">// Create a completion event with successful results</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">completionEvent</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">complete</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-3">&#39;test-subject&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.test.test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">status:</span><span class="hl-1"> </span><span class="hl-3">&#39;success&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">errors:</span><span class="hl-1"> </span><span class="hl-4">null</span><span class="hl-1">,  </span><span class="hl-7">// No errors in this case</span><br/><span class="hl-1">        </span><span class="hl-2">result:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">model:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">provider:</span><span class="hl-1"> </span><span class="hl-3">&#39;openai&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">model:</span><span class="hl-1"> </span><span class="hl-3">&#39;gpt-4-turbo&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-2">json_valid:</span><span class="hl-1"> </span><span class="hl-4">null</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">message:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">role:</span><span class="hl-1"> </span><span class="hl-3">&#39;assistant&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-3">&#39;Hello World&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-2">stop_reason:</span><span class="hl-1"> </span><span class="hl-3">&#39;stop&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">usage:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">time_ms:</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">to_first_token:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-2">average_token:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-2">total:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">                },</span><br/><span class="hl-1">                </span><span class="hl-2">tokens:</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-2">prompt:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-2">completion:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-2">total:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">                },</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Completion events are structured to provide comprehensive information about the workflow's outcome:</p>
<ul>
<li>The status field indicates success or failure</li>
<li>The errors array captures any problems that occurred</li>
<li>The result field contains the workflow's output</li>
</ul>
<p>This structure ensures that orchestrators can make informed decisions about workflow progression.</p>
<a id="md:error-handling-with-systemerror" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Handling with <code>.systemError()</code><a href="#md:error-handling-with-systemerror" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>.systemError()</code> method creates standardized error events for orchestration-specific failures:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createArvoOrchestratorEventFactory</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;arvo-core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">factory</span><span class="hl-1"> = </span><span class="hl-6">createArvoOrchestratorEventFactory</span><span class="hl-1">(</span><span class="hl-2">llmOrchestrator</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-7">// Create an error event for orchestration failures</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">errorEvent</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">systemError</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.test.test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">subject:</span><span class="hl-1"> </span><span class="hl-3">&#39;test-subject&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">error:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-3">&quot;Orchestration timeout exceeded&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<p>System error events in orchestration contexts are particularly important because they can affect multiple services and workflows. The factory ensures these errors are properly structured and can be handled appropriately by the orchestration system.</p>
<a id="md:understanding-event-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Understanding Event Flow<a href="#md:understanding-event-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>These three event types work together to create a complete orchestration lifecycle:</p>
<ol>
<li>An init event starts the workflow</li>
<li>The orchestrator processes various service events</li>
<li>Eventually, either a complete event indicates successful completion, or</li>
<li>A <code>systemError</code> event indicates a workflow failure</li>
</ol>
<p>This structured approach to event creation helps maintain clear and predictable orchestration patterns, even in complex distributed systems.</p>
<a id="md:contract-evolution" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Contract Evolution<a href="#md:contract-evolution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Contract evolution in Arvo follows a simple but powerful principle: services remain independent by evolving behind stable contracts, while the contracts themselves evolve through semantic versioning. While <code>ArvoContract</code> provides the technical mechanism for versioning, successful contract evolution requires thoughtful strategy beyond just code.</p>
<p>Drawing from Meyer's Design by Contract and Fowler's Event Sourcing work, Arvo adopts a clear rule for contract versioning: create a new version for any breaking change that makes the contract more restrictive or changes its restrictions, while non-breaking changes that maintain or reduce restrictions can be handled within the existing version. This approach ensures predictable system evolution while maintaining backward compatibility where possible.</p>
<p>Let's explore how different components of <code>ArvoContract</code> evolve:</p>
<a id="md:contract-fields-evolution" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Contract Fields Evolution<a href="#md:contract-fields-evolution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>URI</strong>: Changes to the contract <code>uri</code> introduce breaking changes, but since <code>ArvoEventFactory</code> handles URI updates automatically, developers rarely need to manage this directly.</li>
<li><strong>Type</strong>: Modifying the event <code>type</code> creates a breaking change requiring service updates.</li>
<li><strong>Accepts/Emits</strong>: These fields drive most system evolution and require careful consideration during changes.</li>
</ul>
<blockquote>
<p><strong>Note</strong>: When creating a new <code>ArvoContract</code>, begin by modeling your contracts after your existing working code, API endpoints, or the general idea of your service's inputs and outputs. Once you have this working foundation, you can gradually refine the contract to be more precise. Remember - a good contract evolves from practical use rather than perfect upfront design. You are required to follow the following evolution patterns only when your first version goes to production after all.</p>
</blockquote>
<a id="md:evolution-of-accepts-data-schema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Evolution of <code>accepts</code> data schema<a href="#md:evolution-of-accepts-data-schema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The evolution of <code>accepts</code> schemas must be managed carefully to maintain system reliability. Here's a comprehensive breakdown of different schema changes and their implications:</p>
<table>
<thead>
<tr>
<th>Change Type</th>
<th>Breaking Change?</th>
<th>Least effort version update</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adding Required Field</td>
<td>Yes</td>
<td>New Version</td>
<td>Makes contract more restrictive by requiring additional data</td>
</tr>
<tr>
<td>Adding Optional Field</td>
<td>No</td>
<td>Same Version</td>
<td>Maintains existing contract restrictions while allowing additional data</td>
</tr>
<tr>
<td>Adding Union Type</td>
<td>No</td>
<td>Same Version</td>
<td>Increases permissiveness while preserving existing functionality</td>
</tr>
<tr>
<td>Removing Union Type</td>
<td>Yes</td>
<td>New Version</td>
<td>Makes contract more restrictive by limiting allowed types</td>
</tr>
<tr>
<td>Changing Field Type</td>
<td>Yes</td>
<td>New Version</td>
<td>Changes nature of contract restrictions</td>
</tr>
<tr>
<td>Removing Any Field</td>
<td>Limited Breaking</td>
<td>Same Version</td>
<td>Following the tolerant reader pattern, removing fields from 'accepts' schema is not a breaking change. Clients can continue sending removed fields, while handlers simply ignore them. TypeScript's type safety ensures handlers don't accidentally reference removed fields during compilation.</td>
</tr>
</tbody>
</table>
<a id="md:evolution-of-emits-data-schema" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Evolution of <code>emits</code> data schema<a href="#md:evolution-of-emits-data-schema" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>emits</code> field in Arvo contracts defines the event schemas a service can produce. Each contract version can specify multiple emit event types, and their evolution follows specific patterns to maintain system reliability:</p>
<table>
<thead>
<tr>
<th>Change Type</th>
<th>Example</th>
<th>Impact</th>
<th>Least effort version update</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adding New Event Type</td>
<td>Adding <code>evt.payment.refunded</code></td>
<td>Non-Breaking</td>
<td>Same Version</td>
<td>The new event type doesn't affect existing event handlers since they'll ignore events they don't recognize. Consumers and producers can add support gradually.</td>
</tr>
<tr>
<td>Adding New Event Type (High Throughput)</td>
<td>Adding <code>evt.payment.refunded</code></td>
<td>Breaking (Tradeoff)</td>
<td>New Version</td>
<td>If a service might be used by an orchestrator, multiple event types in the same version will cause locking in that orchestrator, regardless of service statelessness. Only put high-throughput events (like your 100K/sec) in the same version if you're absolutely certain no orchestrator will ever use this service. Otherwise, create a new version to avoid orchestrator bottlenecks. While this duplicates code, it enables independent optimization.</td>
</tr>
<tr>
<td>Removing Event Type</td>
<td>Removing <code>evt.payment.failed</code></td>
<td>Breaking</td>
<td>New Version</td>
<td>Existing consumers rely on this event for their business logic. Removal breaks their functionality and requires rewrite.</td>
</tr>
<tr>
<td>Adding Required Field</td>
<td>Adding <code>transaction_id: string</code></td>
<td>Limited Breaking</td>
<td>Special Case</td>
<td>Only producer needs changes to provide new field. Consumers following tolerant reader pattern continue working.</td>
</tr>
<tr>
<td>Adding Optional Field</td>
<td>Adding <code>metadata?: object</code></td>
<td>Non-Breaking</td>
<td>Same Version</td>
<td>Optional fields don't break existing consumers since they can ignore unknown fields. Allows gradual adoption of new capabilities.</td>
</tr>
<tr>
<td>Expanding Union Type</td>
<td><code>status: 'success' | 'fail'</code> → adds 'pending'</td>
<td>Non-Breaking</td>
<td>Same Version</td>
<td>Existing code handles known values and ignores new ones by design. Maintains backward compatibility.</td>
</tr>
<tr>
<td>Changing Field Type</td>
<td><code>amount: number</code> → <code>amount: string</code></td>
<td>Breaking</td>
<td>New Version</td>
<td>Fundamental change in data representation. Existing parsing, validation, and business logic would fail.</td>
</tr>
<tr>
<td>Removing Union Value</td>
<td><code>status: 'success' | 'fail' | 'pending'</code> → removes 'pending'</td>
<td>Breaking</td>
<td>New Version</td>
<td>Consumers using 'pending' in business logic or state machines would break. Cannot safely remove without coordination.</td>
</tr>
<tr>
<td>Removing Field</td>
<td>Removing <code>timestamp</code></td>
<td>Breaking</td>
<td>New Version</td>
<td>Any consumer logic depending on this field would fail. Cannot assume field is unused without breaking consumer contract.</td>
</tr>
</tbody>
</table>
<a id="md:anti-patterns-in-schema-design" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Anti-Patterns in Schema Design<a href="#md:anti-patterns-in-schema-design" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Creating robust contracts requires careful consideration of field requirements. Two common anti-patterns to avoid:</p>
<ol>
<li><strong>Universal Optionality</strong>: Making all fields optional undermines the contract's purpose by removing meaningful constraints. A contract should clearly define its required shape and expectations.</li>
<li><strong>Excessive Nullability</strong>: Using too many optional or nullable fields creates uncertainty and complicates validation. Instead, provide meaningful default values that reflect the field's intended use and maintain contract clarity.</li>
</ol>
<a id="md:versioning-nuances" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Versioning Nuances<a href="#md:versioning-nuances" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p><code>ArvoContract</code> takes a distinct approach to versioning that differs from traditional semantic versioning systems. Each version in ArvoContract exists as a completely isolated, standalone definition. When version 1.0.0 exists and a version 1.1.0 is created, these are treated as entirely separate contracts with no implicit relationship or compatibility between them.</p>
<p>This isolation has important implications for how we should approach contract evolution:</p>
<p><strong>When to Stay in Current Version</strong>: If you're adding capabilities that don't break existing consumers - like optional fields, new event types, or expanded enum values - these can be added to the current version. The key test is: will existing consumers continue working without any changes? If yes, enhance the current version.</p>
<p><strong>When to Create New Version</strong>: Any breaking change requires a new version. This includes adding required fields, changing field types, removing fields, or altering how existing fields work. The new version is treated as completely separate from previous versions.</p>
<p>This approach provides absolute clarity about contract behavior. Each version is self-contained, making it impossible to have subtle compatibility issues. While this might seem overly simple, it actually handles the complexity of distributed systems better than elaborate versioning schemes.</p>
<p>Key Implementation Strategy:</p>
<ul>
<li>Start with minimal contracts</li>
<li>Add optional capabilities within versions when possible</li>
<li>Create new versions only for genuine breaking changes</li>
<li>Treat each version as its own contract</li>
<li>Use semantic versioning to signal magnitude of changes, not compatibility</li>
</ul>
<p>This versioning philosophy acknowledges that in distributed systems, clear boundaries and explicit contracts are more valuable than complex compatibility promises.</p>
<a id="md:contract-domains" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Contract Domains<a href="#md:contract-domains" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The <code>domain</code> field in ArvoContract provides a powerful mechanism for organizing and routing events across different processing contexts within your distributed system. Domains enable specialized processing flows such as human-in-the-loop operations, third-party integrations, priority queues, or analytics pipelines while maintaining clear boundaries between different operational contexts.</p>
<a id="md:understanding-contract-domains" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Understanding Contract Domains<a href="#md:understanding-contract-domains" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When you define a domain at the contract level, it serves as a default processing context for all events created using that contract. This provides a consistent way to categorize and route events without requiring explicit domain specification for each event creation:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">paymentContract</span><span class="hl-1"> = </span><span class="hl-6">createArvoContract</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">uri:</span><span class="hl-1"> </span><span class="hl-3">&#39;#/services/payments/transaction&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.payment.process&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">domain:</span><span class="hl-1"> </span><span class="hl-3">&#39;financial.priority&#39;</span><span class="hl-1">,  </span><span class="hl-7">// Default domain for all events</span><br/><span class="hl-1">    </span><span class="hl-2">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">accepts:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-2">amount:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">(),</span><br/><span class="hl-1">                </span><span class="hl-2">currency:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(),</span><br/><span class="hl-1">                </span><span class="hl-2">priority:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">enum</span><span class="hl-1">([</span><span class="hl-3">&#39;standard&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;urgent&#39;</span><span class="hl-1">])</span><br/><span class="hl-1">            }),</span><br/><span class="hl-1">            </span><span class="hl-2">emits:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-3">&#39;evt.payment.processed&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                    </span><span class="hl-2">transaction_id:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(),</span><br/><span class="hl-1">                    </span><span class="hl-2">status:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">()</span><br/><span class="hl-1">                })</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:domain-inheritance-and-override-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Domain Inheritance and Override Patterns<a href="#md:domain-inheritance-and-override-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The domain system follows a clear inheritance hierarchy that provides flexibility while maintaining consistency:</p>
<ol>
<li><strong>Contract Default</strong>: Events inherit the contract's domain by default</li>
<li><strong>Explicit Override</strong>: Event creation can override the contract domain</li>
<li><strong>Explicit Nullification</strong>: Setting <code>domain: null</code> explicitly disables domain routing</li>
</ol>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">factory</span><span class="hl-1"> = </span><span class="hl-6">createArvoEventFactory</span><span class="hl-1">(</span><span class="hl-2">paymentContract</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-7">// Uses contract&#39;s default domain: &#39;financial.priority&#39;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">standardEvent</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">accepts</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.payment.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">data:</span><span class="hl-1"> { </span><span class="hl-2">amount:</span><span class="hl-1"> </span><span class="hl-8">100</span><span class="hl-1">, </span><span class="hl-2">currency:</span><span class="hl-1"> </span><span class="hl-3">&#39;USD&#39;</span><span class="hl-1">, </span><span class="hl-2">priority:</span><span class="hl-1"> </span><span class="hl-3">&#39;standard&#39;</span><span class="hl-1"> }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// Override to different domain</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">analyticsEvent</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">accepts</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.payment.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">domain:</span><span class="hl-1"> </span><span class="hl-3">&#39;analytics.realtime&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">data:</span><span class="hl-1"> { </span><span class="hl-2">amount:</span><span class="hl-1"> </span><span class="hl-8">100</span><span class="hl-1">, </span><span class="hl-2">currency:</span><span class="hl-1"> </span><span class="hl-3">&#39;USD&#39;</span><span class="hl-1">, </span><span class="hl-2">priority:</span><span class="hl-1"> </span><span class="hl-3">&#39;standard&#39;</span><span class="hl-1"> }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// Explicitly disable domain routing</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">undirectedEvent</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">accepts</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.payment.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">domain:</span><span class="hl-1"> </span><span class="hl-4">null</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">data:</span><span class="hl-1"> { </span><span class="hl-2">amount:</span><span class="hl-1"> </span><span class="hl-8">100</span><span class="hl-1">, </span><span class="hl-2">currency:</span><span class="hl-1"> </span><span class="hl-3">&#39;USD&#39;</span><span class="hl-1">, </span><span class="hl-2">priority:</span><span class="hl-1"> </span><span class="hl-3">&#39;standard&#39;</span><span class="hl-1"> }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:domain-naming-conventions" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Domain Naming Conventions<a href="#md:domain-naming-conventions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Domains must follow strict naming rules to ensure consistent routing behavior:</p>
<ul>
<li><strong>Character Set</strong>: Only lowercase letters (a-z), numbers (0-9), and dots (.) are allowed</li>
<li><strong>Structure</strong>: Use dot notation for hierarchical organization (e.g., <code>analytics.realtime</code>, <code>external.partners</code>)</li>
<li><strong>Length</strong>: Keep domain names concise but descriptive</li>
<li><strong>Reserved Names</strong>: Avoid generic names that might conflict with infrastructure components</li>
</ul>
<a id="md:recommended-domain-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Recommended Domain Patterns<a href="#md:recommended-domain-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-7">// Functional domains</span><br/><span class="hl-12">domain</span><span class="hl-1">: </span><span class="hl-3">&#39;analytics&#39;</span><span class="hl-1">          </span><span class="hl-7">// Analytics processing</span><br/><span class="hl-12">domain</span><span class="hl-1">: </span><span class="hl-3">&#39;external&#39;</span><span class="hl-1">           </span><span class="hl-7">// Third-party integrations</span><br/><span class="hl-12">domain</span><span class="hl-1">: </span><span class="hl-3">&#39;priority.high&#39;</span><span class="hl-1">      </span><span class="hl-7">// High-priority processing</span><br/><span class="hl-12">domain</span><span class="hl-1">: </span><span class="hl-3">&#39;batch.nightly&#39;</span><span class="hl-1">      </span><span class="hl-7">// Batch processing contexts</span><br/><br/><span class="hl-7">// Environmental domains</span><br/><span class="hl-12">domain</span><span class="hl-1">: </span><span class="hl-3">&#39;staging.validation&#39;</span><span class="hl-1"> </span><span class="hl-7">// Staging environment validation</span><br/><span class="hl-12">domain</span><span class="hl-1">: </span><span class="hl-3">&#39;canary.testing&#39;</span><span class="hl-1">     </span><span class="hl-7">// Canary deployment testing</span><br/><br/><span class="hl-7">// Operational domains</span><br/><span class="hl-12">domain</span><span class="hl-1">: </span><span class="hl-3">&#39;human.review&#39;</span><span class="hl-1">       </span><span class="hl-7">// Human-in-the-loop processes</span><br/><span class="hl-12">domain</span><span class="hl-1">: </span><span class="hl-3">&#39;compliance.audit&#39;</span><span class="hl-1">   </span><span class="hl-7">// Compliance and audit workflows</span>
</code><button type="button">Copy</button></pre>

<a id="md:orchestrator-domain-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Orchestrator Domain Handling<a href="#md:orchestrator-domain-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Orchestrator contracts have special domain handling that supports complex workflow coordination. The domain propagates through the orchestration hierarchy, maintaining context across parent-child relationships:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">orderOrchestrator</span><span class="hl-1"> = </span><span class="hl-6">createArvoOrchestratorContract</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">uri:</span><span class="hl-1"> </span><span class="hl-3">&#39;#/orchestrators/order/fulfillment&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;order.fulfillment&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">domain:</span><span class="hl-1"> </span><span class="hl-3">&#39;priority.processing&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">init:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-2">order_id:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(),</span><br/><span class="hl-1">                </span><span class="hl-2">priority_level:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">enum</span><span class="hl-1">([</span><span class="hl-3">&#39;standard&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;express&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;overnight&#39;</span><span class="hl-1">])</span><br/><span class="hl-1">            }),</span><br/><span class="hl-1">            </span><span class="hl-2">complete:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">object</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-2">fulfillment_status:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">(),</span><br/><span class="hl-1">                </span><span class="hl-2">tracking_number:</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-6">string</span><span class="hl-1">().</span><span class="hl-6">optional</span><span class="hl-1">()</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">factory</span><span class="hl-1"> = </span><span class="hl-6">createArvoOrchestratorEventFactory</span><span class="hl-1">(</span><span class="hl-2">orderOrchestrator</span><span class="hl-1">.</span><span class="hl-6">version</span><span class="hl-1">(</span><span class="hl-3">&#39;1.0.0&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-7">// Inherits orchestrator&#39;s domain in the execution context</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">initEvent</span><span class="hl-1"> = </span><span class="hl-2">factory</span><span class="hl-1">.</span><span class="hl-6">init</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-3">&#39;com.order.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">parentSubject$$:</span><span class="hl-1"> </span><span class="hl-4">null</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">order_id:</span><span class="hl-1"> </span><span class="hl-3">&#39;ord-123&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">priority_level:</span><span class="hl-1"> </span><span class="hl-3">&#39;express&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// The orchestration subject contains domain information</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">subject</span><span class="hl-1"> = </span><span class="hl-2">ArvoOrchestrationSubject</span><span class="hl-1">.</span><span class="hl-6">parse</span><span class="hl-1">(</span><span class="hl-2">initEvent</span><span class="hl-1">.</span><span class="hl-2">subject</span><span class="hl-1">);</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">subject</span><span class="hl-1">.</span><span class="hl-2">execution</span><span class="hl-1">.</span><span class="hl-2">domain</span><span class="hl-1">); </span><span class="hl-7">// &#39;priority.processing&#39;</span>
</code><button type="button">Copy</button></pre>

<a id="md:best-practices-for-domain-usage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Best Practices for Domain Usage<a href="#md:best-practices-for-domain-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><blockquote>
<p><strong>Caution</strong>: Use contract domain features sparingly and with clear intentionality. Events inherit domains from contracts by default, which can cause implicit routing behavior that makes debugging extremely challenging. The recommended default pattern is to keep contracts domain-free and instead specify domains explicitly during event creation within handlers. This approach ensures domain assignment remains visible and intentional at the point of event generation. Only assign contract-level domains when you are absolutely certain that every event from that contract should always be processed within that specific domain context.</p>
</blockquote>
<p><strong>Domain Boundaries</strong>: Use domains to create clear operational boundaries that align with your system's processing requirements. Each domain should represent a distinct processing context with its own characteristics (latency requirements, security policies, resource allocation).</p>
<p><strong>Avoid Over-Segmentation</strong>: While domains provide powerful routing capabilities, avoid creating too many granular domains that complicate your system's operational model. Start with broad categories and refine as needed.</p>
<p><strong>Consistent Naming</strong>: Establish domain naming conventions early and document them clearly. Consistent naming helps with operational understanding and automation.</p>
<p><strong>Domain Documentation</strong>: Document what each domain represents, its processing characteristics, and any special handling requirements. This becomes crucial for system operations and troubleshooting.</p>
<p><strong>Migration Strategy</strong>: When introducing domains to existing systems, start with a null domain default and gradually migrate services to appropriate domains. This approach minimizes disruption while enabling gradual adoption of domain-based routing.</p>
<p>The domain system in ArvoContract provides a foundation for sophisticated event routing and processing while maintaining the simplicity and clarity that makes Arvo effective for distributed system development.</p>
<a id="md:conclusion" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Conclusion<a href="#md:conclusion" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Arvo represents a thoughtful evolution in event-driven system design, addressing the fundamental challenges of building reliable and maintainable distributed systems. At its core, Arvo's contract-first approach transforms how services communicate by making contracts first-class citizens in the development process. This isn't just a technical choice – it's a strategic decision that brings clarity to service boundaries, ensures type safety, and provides a clear path for system evolution.</p>
<p>What makes Arvo particularly powerful is its pragmatic approach to managing change. Rather than treating coupling as inherently negative, it acknowledges that some coupling is inevitable and provides tools to manage it effectively. The combination of TypeScript-based contracts, semantic versioning, and clear evolution patterns creates a framework where services can evolve independently while maintaining system-wide reliability. The framework's sophisticated event creation and validation mechanisms, paired with its orchestration capabilities, enable developers to build complex distributed systems that remain maintainable as they grow.</p>
<p>Perhaps most importantly, Arvo's design reflects a deep understanding of real-world challenges in distributed systems. By drawing inspiration from established patterns like Design by Contract and Event Sourcing, while incorporating modern tools like TypeScript and Zod, it provides a practical solution that balances theoretical correctness with developer experience. The result is a framework that not only helps build reliable distributed systems today but also provides a clear path for evolving them tomorrow.</p>
<a id="md:appendix" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Appendix<a href="#md:appendix" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="md:a-brief-history-of-service-contracts" class="tsd-anchor"></a><h2 class="tsd-anchor-link">A Brief History of Service Contracts<a href="#md:a-brief-history-of-service-contracts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Historically, service contracts have played a crucial role in distributed systems development. As systems grew more complex and distributed, the need for formal service contracts became increasingly apparent, leading to several significant developments in contract definition and management.</p>
<a id="md:wsdl-web-service-description-language" class="tsd-anchor"></a><h3 class="tsd-anchor-link">WSDL (Web Service Description Language)<a href="#md:wsdl-web-service-description-language" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>WSDL emerged in the early 2000s as part of the SOAP/XML web services ecosystem, representing one of the first comprehensive approaches to formal service contracts. At its core, WSDL provided a standardized way to describe network services as collections of endpoints operating on messages. The XML-based WSDL documents served as formal contracts between service providers and consumers, defining everything from data types to operation signatures.</p>
<p>A typical WSDL contract included:</p>
<ul>
<li>Interface definitions specifying available operations</li>
<li>Data type definitions through XML Schema (XSD)</li>
<li>Binding information describing how to access the service</li>
<li>Service location information</li>
</ul>
<p>The WSDL approach introduced several important concepts that influenced future contract systems:</p>
<ul>
<li>Explicit contract definitions</li>
<li>Strong type checking through XML Schema</li>
<li>Tool-based code generation</li>
<li>Platform-independent service descriptions</li>
</ul>
<p>However, WSDL faced significant challenges in practice. The XML-based specifications were verbose and difficult to maintain. The code generation approach, while ensuring type safety, created a rigid development workflow that struggled to adapt to changing requirements. Development teams found themselves managing complex build processes to regenerate code whenever contracts changed, leading to deployment coordination challenges across services.</p>
<p>The separation between contract specification (WSDL) and implementation code also created friction in the development process. Developers had to context-switch between XML specifications and implementation code, making it harder to understand and evolve services. The tooling-dependent workflow often led to version mismatches and integration problems.</p>
<a id="md:protobuffers" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Protobuffers<a href="#md:protobuffers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Protocol Buffers, developed at Google, emerged as a transformative approach to service contracts and data serialization. Unlike its predecessors, Protocol Buffers introduced a simple Interface Definition Language (IDL) that struck a balance between human readability and machine efficiency. The system's core innovation was its approach to contract definition through <code>.proto</code> files, which serve as the single source of truth for data structures and service interfaces. These definitions could then be compiled into type-safe code for multiple programming languages, ensuring consistency across different parts of a distributed system.</p>
<p>What truly set Protocol Buffers apart was its approach to versioning and compatibility. By assigning unique numbers to each field in a message definition, Protocol Buffers created a robust system for schema evolution. These field numbers, once assigned, become a permanent part of the contract, ensuring that older clients can still read newer messages and newer clients can process older messages. This backward and forward compatibility was achieved without requiring complex transformation layers or version negotiation protocols. The system also introduced clear rules about what changes were safe to make: fields could be added if they were optional, required fields couldn't be removed, and field numbers could never be reused.</p>
<p>The binary serialization format of Protocol Buffers provided significant performance advantages over text-based formats like XML or JSON. Messages were smaller, faster to serialize and deserialize, and type-safe by design. This efficiency made Protocol Buffers particularly well-suited for high-performance systems and internal service communication. The combination of clear contract definitions, efficient serialization, and strong compatibility guarantees made Protocol Buffers a standard tool in distributed system development, influencing how future contract systems would approach these challenges.</p>
<a id="md:challenges" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Challenges<a href="#md:challenges" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Protocol Buffers, developed at Google, emerged as a transformative approach to service contracts and data serialisation. They introduced a simple Interface Definition Language (IDL) that struck a balance between human readability and machine efficiency. Consider this typical <strong>proto</strong> definition:</p>
<pre><code class="protobuf">syntax = "proto3";

package payment;

message PaymentRequest {
    string payment_id = 1;
    double amount = 2;
    string currency = 3;
    PaymentType type = 4;
    map<string, string> metadata = 5;
}

enum PaymentType {
    CREDIT_CARD = 0;
    BANK_TRANSFER = 1;
    CRYPTO = 2;
}

service PaymentService {
    rpc ProcessPayment (PaymentRequest) returns (PaymentResponse);
}
</code><button type="button">Copy</button></pre>

<p>While this looks straightforward, the development workflow becomes complex. Teams need to:</p>
<ul>
<li>Maintain separate <code>.proto</code> files</li>
<li>Run <code>protoc</code> to generate code</li>
<li>Manage generated code in version control</li>
<li>Coordinate <strong>proto</strong> updates across services</li>
<li>Deal with language-specific protobuf runtime dependencies</li>
</ul>
<p>What truly set Protocol Buffers apart was its sophisticated approach to versioning and compatibility through field numbers. However, this created its own challenges:</p>
<pre><code class="protobuf">// Version 1
message User {
    string name = 1;
    string email = 2;
}

// Version 2 - Can't remove email or reuse field 2
message User {
    string name = 1;
    // email removed but number 2 is forever reserved
    string phone = 3;    // Must use new number
    Address address = 4; // New field
}

// This creates "holes" in field numbers over time
message User {
    string name = 1;
    // 2 reserved forever
    string phone = 3;
    Address address = 4;
    string preferred_name = 8; // Added later
    // 5,6,7 used in abandoned features
}
</code><button type="button">Copy</button></pre>

<p>The binary serialisation format provided significant performance advantages but introduced practical challenges:</p>
<ul>
<li>Messages aren't human-readable for debugging</li>
<li>Need special tools to inspect traffic</li>
<li>Debugging production issues becomes harder</li>
<li>Integration testing is more complex</li>
</ul>
<p>I'll help improve the practicality section to be more balanced and better structured. Here's a revised version:</p>
<a id="md:practicality" class="tsd-anchor"></a><h6 class="tsd-anchor-link">Practicality<a href="#md:practicality" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h6><p>While Protocol Buffers offer robust service contracts and efficient serialization, several practical considerations affect their adoption in modern microservices architectures:</p>
<ul>
<li>Development Complexity
<ul>
<li>Teams need to invest time in learning the Protocol Buffer ecosystem, including the IDL syntax, code generation workflow, and versioning rules</li>
<li>Build systems require additional configuration to handle .proto files and generated code</li>
<li>Developers must understand and maintain two layers: the contract definitions and the implementation code</li>
</ul>
</li>
<li>Integration Challenges
<ul>
<li>JSON remains the de facto standard for web APIs, making Protocol Buffers less suitable for public-facing services</li>
<li>Interoperability with external systems often requires translation layers between Protobuf and JSON</li>
<li>Tools and debugging workflows common in REST/JSON ecosystems may not work with Protocol Buffer services</li>
</ul>
</li>
<li>Developer Experience
<ul>
<li>The strict versioning system, while powerful, adds cognitive overhead to schema evolution</li>
<li>Field numbering rules and compatibility constraints require careful planning and documentation</li>
<li>Binary format makes debugging more difficult without specialized tools</li>
<li>Generated code can be verbose and less intuitive than hand-written alternatives</li>
</ul>
</li>
</ul>
<p>These practical challenges often lead teams to carefully evaluate whether Protocol Buffers' benefits outweigh their complexity, particularly in smaller microservices architectures or when interoperability with external systems is a priority. However, for large-scale distributed systems with strong consistency requirements, the investment in Protocol Buffers can pay off through improved type safety and performance.
I'll write a comprehensive section on OpenAPI that covers all our discussion points.</p>
<a id="md:openapi-formerly-swagger" class="tsd-anchor"></a><h3 class="tsd-anchor-link">OpenAPI (Formerly Swagger)<a href="#md:openapi-formerly-swagger" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>OpenAPI Specification has emerged as a dominant standard for describing RESTful APIs, evolving from its origins as Swagger. It provides a language-agnostic approach to API documentation and contract definition using YAML or JSON format.</p>
<a id="md:key-features-and-benefits" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Key Features and Benefits<a href="#md:key-features-and-benefits" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="yaml">openapi: 3.0.0
info:
  title: Payment API
  version: 1.0.0
paths:
  /payments:
    post:
      summary: Process a payment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payment_id:
                  type: string
                amount:
                  type: number
                  minimum: 0
                currency:
                  type: string
                  enum: [USD, EUR, GBP]
      responses:
        '200':
          description: Payment processed successfully
</code><button type="button">Copy</button></pre>

<p>The specification offers several advantages:</p>
<ul>
<li>Human-readable format that's easy to understand and modify</li>
<li>Rich ecosystem of tools for documentation, testing, and code generation</li>
<li>Comprehensive support for HTTP-specific features</li>
<li>Interactive documentation through Swagger UI</li>
<li>Wide industry adoption and tooling support</li>
<li>Strong integration with modern frameworks</li>
</ul>
<a id="md:modern-framework-integration" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Modern Framework Integration<a href="#md:modern-framework-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Modern frameworks have significantly improved OpenAPI's developer experience:</p>
<pre><code class="python"># FastAPI example of automatic spec generation
from fastapi import FastAPI

app = FastAPI()

@app.post("/payments")
async def create_payment(payment: Payment):
    # OpenAPI spec automatically generated
    # Validation included
    return {"transaction_id": "123"}
</code><button type="button">Copy</button></pre>

<p>This integration provides:</p>
<ul>
<li>Automatic spec generation from code</li>
<li>Type safety and validation out of the box</li>
<li>Live documentation that stays in sync with code</li>
<li>Reduced boilerplate</li>
<li>Strong IDE support</li>
<li>Extensive middleware ecosystem</li>
</ul>
<a id="md:challenges-and-limitations" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Challenges and Limitations<a href="#md:challenges-and-limitations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>
<p><strong>Versioning</strong> remains one of OpenAPI's most significant challenges, stemming from its lack of built-in version management mechanisms. Unlike Protocol Buffers with its explicit field numbering system, OpenAPI leaves versioning strategies up to implementation teams, leading to inconsistent approaches across the industry. Teams often struggle between URL-based versioning (/v1/resource) and header-based versioning, each bringing its own complications. This absence of standardised versioning makes it particularly challenging to maintain multiple API versions simultaneously or to implement automated compatibility checking. Without clear guidelines for breaking versus non-breaking changes, teams often find themselves maintaining complex documentation to track version differences and struggling to ensure backward compatibility.</p>
</li>
<li>
<p>The <strong>producer-centric</strong> nature of modern OpenAPI implementations presents another significant limitation, particularly with contemporary frameworks and tools. While frameworks like FastAPI and HonoJS have made OpenAPI more developer-friendly, they've inadvertently shifted the specification away from its contract-first origins. The contract now typically emerges as a byproduct of implementation code, with data models (like Pydantic or Zod) serving double duty as both application models and contract definitions. This coupling of application data with contracts creates a one-sided dynamic where producers unilaterally define and modify contracts without meaningful input from consumers. The result is a less collaborative contract environment where consumers have limited guarantees about contract stability and often discover changes only after they're implemented.</p>
</li>
<li>
<p><strong>Technical limitations</strong> further constrain OpenAPI's effectiveness as a complete contract solution. Being exclusively focused on REST/HTTP APIs, it lacks the versatility of protocol-agnostic solutions like Protocol Buffers. The specification's runtime validation approach, while flexible, doesn't provide the same level of safety as compile-time checks. Teams must also grapple with the perpetual challenge of keeping specifications and implementation code synchronised, or in the case of modern tooling, accept that OpenAPI becomes more of a documentation tool than a true contracting mechanism. This documentation-first approach, while valuable for API understanding, falls short of providing the robust contract enforcement and evolution capabilities needed in complex distributed systems.</p>
</li>
</ul>
<p>Despite its limitations, OpenAPI is a powerful tool for API documentation and contract definition, especially when combined with modern frameworks. Its success in the REST API space demonstrates the value of standardised API descriptions, even with the challenges of maintaining true contract-first development practices.</p>
<a id="md:asyncapi" class="tsd-anchor"></a><h3 class="tsd-anchor-link">AsyncAPI<a href="#md:asyncapi" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>AsyncAPI emerged as a response to the growing adoption of event-driven architectures and the limitations of OpenAPI in describing asynchronous APIs. While OpenAPI excelled at documenting RESTful endpoints, it couldn't adequately capture the complexities of message-based systems, WebSocket connections, or pub/sub patterns. AsyncAPI filled this gap by providing a specification designed specifically for asynchronous APIs while maintaining familiar concepts from OpenAPI.</p>
<a id="md:key-features-and-benefits-1" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Key Features and Benefits<a href="#md:key-features-and-benefits-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="yaml">asyncapi: 2.5.0
info:
  title: Payment Events API
  version: 1.0.0
channels:
  payment/processed:
    publish:
      message:
        payload:
          type: object
          properties:
            payment_id:
              type: string
            status:
              type: string
              enum: [SUCCESS, FAILED]
            timestamp:
              type: string
              format: date-time
    subscribe:
      message:
        payload:
          type: object
          properties:
            payment_id:
              type: string
            amount:
              type: number
            currency:
              type: string
</code><button type="button">Copy</button></pre>

<p>AsyncAPI brings several unique advantages to asynchronous service contracts:</p>
<ul>
<li>Native support for multiple messaging protocols (MQTT, AMQP, Kafka, WebSocket)</li>
<li>Clear distinction between publish and subscribe operations</li>
<li>Built-in schema validation for message payloads</li>
<li>Support for message headers and correlation patterns</li>
<li>Runtime documentation through AsyncAPI Studio</li>
<li>Code generation capabilities for multiple languages</li>
</ul>
<a id="md:challenges-and-limitations-1" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Challenges and Limitations<a href="#md:challenges-and-limitations-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>
<p><strong>Message Flow and Correlation</strong>: AsyncAPI provides basic support for message correlation through the Correlation ID Object (as defined in the specification), which allows for message tracing and correlation using runtime expressions. However, the specification focuses primarily on describing individual message structures and channels rather than complex message flows. While correlation IDs provide a way to link related messages, the specification itself does not provide explicit constructs for documenting complex event chains or choreography patterns. This is actually a fair limitation of the AsyncAPI. There has been discussion on this front <a href="https://github.com/asyncapi/spec/issues/94" target="_blank" class="external">in Github Issue</a></p>
</li>
<li>
<p><strong>Protocol-Specific Features</strong>: The AsyncAPI specification aims to be protocol-agnostic, but this creates challenges in representing protocol-specific features. As documented in the AsyncAPI <a href="https://www.asyncapi.com/docs/reference/specification/v2.5.0#bindingsObject" target="_blank" class="external">bindings section</a>, while the specification provides binding objects for different protocols, these don't fully capture all protocol-specific behaviours. Again from a contracts stand point that does not seem to be a very problematic issue.</p>
</li>
<li>
<p><strong>Tooling Ecosystem</strong>: The AsyncAPI tooling ecosystem, while growing, is still maturing. The official <a href="https://github.com/asyncapi/generator" target="_blank" class="external">AsyncAPI Generator</a> and AsyncAPI Studio provide basic functionality, but as noted in the AsyncAPI community <a href="https://github.com/asyncapi/community" target="_blank" class="external">discussions</a>, there are gaps in areas like:</p>
<ul>
<li>Code generation quality for certain languages</li>
<li>Runtime validation tools</li>
<li>Integration testing frameworks</li>
<li>IDE support</li>
</ul>
</li>
<li>
<p><strong>Contract Implementation Model</strong>: The AsyncAPI specification's current trajectory seems mirrors OpenAPI's evolution in the REST space, focusing primarily on documentation capabilities. While this approach excels at API documentation and discovery, it can lead to a producer-centric implementation model where contracts become descriptive rather than prescriptive. This challenges the original contract-first design philosophy, potentially impacting the specification's effectiveness as a strict contract enforcement mechanism in event-driven architectures.</p>
</li>
</ul>
<p>Despite these challenges, AsyncAPI represents a crucial evolution in service contract specifications, particularly as systems increasingly adopt event-driven architectures. Its ability to document asynchronous interactions in a standardised way provides valuable insights into system behaviour and helps teams maintain consistency across distributed systems. As the specification and its ecosystem continue to mature, it's likely to become an essential tool in the modern API landscape, complementing existing specifications like OpenAPI and Protocol Buffers.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:arvocontract---a-pragmatic-contract-system"><span>Arvo<wbr/>Contract -<wbr/> <wbr/>A pragmatic contract system</span></a><a href="#md:getting-started-with-arvocontract"><span>Getting <wbr/>Started with <wbr/>Arvo<wbr/>Contract</span></a><ul><li><a href="#md:your-first-contract"><span>Your <wbr/>First <wbr/>Contract</span></a></li><li><ul><li><a href="#md:step-1-define-your-first-contract"><span>Step 1: <wbr/>Define <wbr/>Your <wbr/>First <wbr/>Contract</span></a></li><li><a href="#md:step-2-create-events-using-your-contract"><span>Step 2: <wbr/>Create <wbr/>Events <wbr/>Using <wbr/>Your <wbr/>Contract</span></a></li><li><a href="#md:step-3-run-your-first-example"><span>Step 3: <wbr/>Run <wbr/>Your <wbr/>First <wbr/>Example</span></a></li></ul></li><li><a href="#md:understanding-what-you-built"><span>Understanding <wbr/>What <wbr/>You <wbr/>Built</span></a></li><li><ul><li><a href="#md:event-structure"><span>Event <wbr/>Structure</span></a></li><li><a href="#md:type-safety"><span>Type <wbr/>Safety</span></a></li></ul></li><li><a href="#md:next-steps-building-a-simple-service-pattern"><span>Next <wbr/>Steps: <wbr/>Building a <wbr/>Simple <wbr/>Service <wbr/>Pattern</span></a></li><li><ul><li><a href="#md:step-4-create-a-simple-event-handler"><span>Step 4: <wbr/>Create a <wbr/>Simple <wbr/>Event <wbr/>Handler</span></a></li><li><a href="#md:step-5-run-the-service-handler"><span>Step 5: <wbr/>Run the <wbr/>Service <wbr/>Handler</span></a></li></ul></li><li><a href="#md:key-patterns-youve-learned"><span>Key <wbr/>Patterns <wbr/>You&#39;ve <wbr/>Learned</span></a></li><li><ul><li><a href="#md:1-contract-first-design"><span>1. <wbr/>Contract-<wbr/>First <wbr/>Design</span></a></li><li><a href="#md:2-event-factory-pattern"><span>2. <wbr/>Event <wbr/>Factory <wbr/>Pattern</span></a></li><li><a href="#md:3-service-handler-pattern"><span>3. <wbr/>Service <wbr/>Handler <wbr/>Pattern</span></a></li><li><a href="#md:4-type-safety-throughout"><span>4. <wbr/>Type <wbr/>Safety <wbr/>Throughout</span></a></li></ul></li><li><a href="#md:whats-next"><span>What&#39;s <wbr/>Next?</span></a></li><li><a href="#md:common-questions"><span>Common <wbr/>Questions</span></a></li></ul><a href="#md:core-concepts"><span>Core concepts</span></a><ul><li><ul><li><a href="#md:event-processing-and-error-handling"><span>Event processing and error handling</span></a></li><li><a href="#md:event-chaining-and-orchestration"><span>Event <wbr/>Chaining and <wbr/>Orchestration</span></a></li></ul></li></ul><a href="#md:reliable-service-communication"><span>Reliable <wbr/>Service <wbr/>Communication</span></a><ul><li><ul><li><a href="#md:managing-coupling-in-event-driven-systems"><span>Managing <wbr/>Coupling in <wbr/>Event-<wbr/>Driven <wbr/>Systems</span></a></li><li><a href="#md:the-contract-first-approach"><span>The <wbr/>Contract-<wbr/>First <wbr/>Approach</span></a></li><li><a href="#md:contract-implementation"><span>Contract <wbr/>Implementation</span></a></li><li><a href="#md:benefits-of-contract-based-communication"><span>Benefits of <wbr/>Contract-<wbr/>Based <wbr/>Communication</span></a></li></ul></li></ul><a href="#md:the-arvocontract"><span>The <wbr/>Arvo<wbr/>Contract</span></a><ul><li><a href="#md:first-class-contract-system"><span>First-<wbr/>Class <wbr/>Contract <wbr/>System</span></a></li><li><a href="#md:practical-advantages"><span>Practical <wbr/>Advantages</span></a></li><li><a href="#md:contract-distribution"><span>Contract <wbr/>Distribution</span></a></li><li><a href="#md:arvocontract-implementation-example"><span>Arvo<wbr/>Contract <wbr/>Implementation <wbr/>Example</span></a></li><li><a href="#md:type-inference-and-contract-versioning"><span>Type <wbr/>Inference and <wbr/>Contract <wbr/>Versioning</span></a></li><li><ul><li><a href="#md:basic-version-selection-and-type-inference"><span>Basic <wbr/>Version <wbr/>Selection and <wbr/>Type <wbr/>Inference</span></a></li><li><a href="#md:advanced-type-inference-with-inferversionedarvocontract"><span>Advanced <wbr/>Type <wbr/>Inference with <wbr/>Infer<wbr/>Versioned<wbr/>Arvo<wbr/>Contract</span></a></li></ul></li><li><a href="#md:understanding-arvoevent-dataschema-construction"><span>Understanding <wbr/>Arvo<wbr/>Event dataschema <wbr/>Construction</span></a></li><li><ul><li><a href="#md:construction-pattern"><span>Construction <wbr/>Pattern</span></a></li><li><a href="#md:why-this-matters"><span>Why <wbr/>This <wbr/>Matters</span></a></li><li><a href="#md:real-world-example"><span>Real-<wbr/>World <wbr/>Example</span></a></li></ul></li><li><a href="#md:additional-contract-factories"><span>Additional <wbr/>Contract <wbr/>Factories</span></a></li><li><ul><li><a href="#md:simple-contracts-with-createsimplearvocontract"><span>Simple <wbr/>Contracts with create<wbr/>Simple<wbr/>Arvo<wbr/>Contract</span></a></li><li><ul><li><a href="#md:schema-reuse-and-contract-evolution"><span>Schema <wbr/>Reuse and <wbr/>Contract <wbr/>Evolution</span></a></li><li><a href="#md:when-to-reuse-schemas"><span>When to <wbr/>Reuse <wbr/>Schemas</span></a></li><li><a href="#md:example-genai-services"><span>Example: <wbr/>GenAI <wbr/>Services</span></a></li></ul></li><li><a href="#md:orchestrator-contracts"><span>Orchestrator <wbr/>Contracts</span></a></li><li><ul><li><a href="#md:parent-subject-in-orchestration"><span>Parent <wbr/>Subject in <wbr/>Orchestration</span></a></li><li><a href="#md:execution-context-flow"><span>Execution <wbr/>Context <wbr/>Flow</span></a></li><li><a href="#md:creating-orchestrator-contracts"><span>Creating <wbr/>Orchestrator <wbr/>Contracts</span></a></li><li><a href="#md:type-safety-and-contract-usage"><span>Type <wbr/>Safety and <wbr/>Contract <wbr/>Usage</span></a></li></ul></li></ul></li></ul><a href="#md:event-creation"><span>Event <wbr/>Creation</span></a><ul><li><a href="#md:core-concepts-1"><span>Core <wbr/>Concepts</span></a></li><li><a href="#md:the-arvoeventfactory"><span>The <wbr/>Arvo<wbr/>Event<wbr/>Factory</span></a></li><li><ul><li><a href="#md:creating-receivable-events"><span>Creating <wbr/>Receivable <wbr/>Events</span></a></li><li><a href="#md:creating-emittable-events"><span>Creating <wbr/>Emittable <wbr/>Events</span></a></li><li><a href="#md:creating-system-error"><span>Creating <wbr/>System <wbr/>Error</span></a></li></ul></li><li><a href="#md:the-arvoorchestratoreventfactory"><span>The <wbr/>Arvo<wbr/>Orchestrator<wbr/>Event<wbr/>Factory</span></a></li><li><ul><li><a href="#md:initialization-events-with-init"><span>Initialization <wbr/>Events with .init()</span></a></li><li><a href="#md:completion-events-with-complete"><span>Completion <wbr/>Events with .complete()</span></a></li><li><a href="#md:error-handling-with-systemerror"><span>Error <wbr/>Handling with .system<wbr/>Error()</span></a></li><li><a href="#md:understanding-event-flow"><span>Understanding <wbr/>Event <wbr/>Flow</span></a></li></ul></li></ul><a href="#md:contract-evolution"><span>Contract <wbr/>Evolution</span></a><ul><li><a href="#md:contract-fields-evolution"><span>Contract <wbr/>Fields <wbr/>Evolution</span></a></li><li><a href="#md:evolution-of-accepts-data-schema"><span>Evolution of accepts data schema</span></a></li><li><a href="#md:evolution-of-emits-data-schema"><span>Evolution of emits data schema</span></a></li><li><a href="#md:anti-patterns-in-schema-design"><span>Anti-<wbr/>Patterns in <wbr/>Schema <wbr/>Design</span></a></li></ul><a href="#md:versioning-nuances"><span>Versioning <wbr/>Nuances</span></a><a href="#md:contract-domains"><span>Contract <wbr/>Domains</span></a><ul><li><a href="#md:understanding-contract-domains"><span>Understanding <wbr/>Contract <wbr/>Domains</span></a></li><li><a href="#md:domain-inheritance-and-override-patterns"><span>Domain <wbr/>Inheritance and <wbr/>Override <wbr/>Patterns</span></a></li><li><a href="#md:domain-naming-conventions"><span>Domain <wbr/>Naming <wbr/>Conventions</span></a></li><li><ul><li><a href="#md:recommended-domain-patterns"><span>Recommended <wbr/>Domain <wbr/>Patterns</span></a></li></ul></li><li><a href="#md:orchestrator-domain-handling"><span>Orchestrator <wbr/>Domain <wbr/>Handling</span></a></li><li><a href="#md:best-practices-for-domain-usage"><span>Best <wbr/>Practices for <wbr/>Domain <wbr/>Usage</span></a></li></ul><a href="#md:conclusion"><span>Conclusion</span></a><a href="#md:appendix"><span>Appendix</span></a><ul><li><a href="#md:a-brief-history-of-service-contracts"><span>A <wbr/>Brief <wbr/>History of <wbr/>Service <wbr/>Contracts</span></a></li><li><ul><li><a href="#md:wsdl-web-service-description-language"><span>WSDL (<wbr/>Web <wbr/>Service <wbr/>Description <wbr/>Language)</span></a></li><li><a href="#md:protobuffers"><span>Protobuffers</span></a></li><li><ul><li><a href="#md:challenges"><span>Challenges</span></a></li><li><ul><li><ul><li><a href="#md:practicality"><span>Practicality</span></a></li></ul></li></ul></li></ul></li><li><a href="#md:openapi-formerly-swagger"><span>OpenAPI (<wbr/>Formerly <wbr/>Swagger)</span></a></li><li><ul><li><a href="#md:key-features-and-benefits"><span>Key <wbr/>Features and <wbr/>Benefits</span></a></li><li><a href="#md:modern-framework-integration"><span>Modern <wbr/>Framework <wbr/>Integration</span></a></li><li><a href="#md:challenges-and-limitations"><span>Challenges and <wbr/>Limitations</span></a></li></ul></li><li><a href="#md:asyncapi"><span>AsyncAPI</span></a></li><li><ul><li><a href="#md:key-features-and-benefits-1"><span>Key <wbr/>Features and <wbr/>Benefits</span></a></li><li><a href="#md:challenges-and-limitations-1"><span>Challenges and <wbr/>Limitations</span></a></li></ul></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>arvo-core</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a> with <a href="https://github.com/KillerJulian/typedoc-github-theme" target="_blank">typedoc-github-theme</a></p></footer><div class="overlay"></div></body></html>
